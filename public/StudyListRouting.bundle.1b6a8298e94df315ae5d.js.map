{"version":3,"sources":["webpack:///./googleCloud/utils/helpers.js","webpack:///./googleCloud/utils/CancellationToken.js","webpack:///./googleCloud/api/DicomUploadService.js","webpack:///./googleCloud/DicomUploader.js","webpack:///./googleCloud/DicomFileUploaderModal.js","webpack:///./googleCloud/ConnectedDicomFilesUploader.js","webpack:///./googleCloud/DicomStoreList.js","webpack:///./googleCloud/DicomStorePicker.js","webpack:///./googleCloud/DatasetsList.js","webpack:///./googleCloud/DatasetPicker.js","webpack:///./googleCloud/ProjectsList.js","webpack:///./googleCloud/ProjectPicker.js","webpack:///./googleCloud/LocationsList.js","webpack:///./googleCloud/LocationPicker.js","webpack:///./googleCloud/DatasetSelector.js","webpack:///./googleCloud/DicomStorePickerModal.js","webpack:///./googleCloud/ConnectedDicomStorePicker.js","webpack:///./studylist/StudyListRoute.js","webpack:///./studylist/ConnectedStudyList.js","webpack:///./studylist/StudyListRouting.js","webpack:///./customHooks/usePrevious.js","webpack:///./googleCloud/api/GoogleCloudApi.js","webpack:///./googleCloud/utils/getServers.js","webpack:///./customHooks/useServer.js","webpack:///./lib/localFileLoaders/fileLoader.js","webpack:///./lib/localFileLoaders/pdfFileLoader.js","webpack:///./lib/localFileLoaders/dicomFileLoader.js","webpack:///./lib/localFileLoaders/fileLoaderService.js","webpack:///./lib/filesToStudies.js"],"names":["formatFileSize","size","n","Math","floor","log","pow","toFixed","httpErrorToStr","error","response","jsonResponse","JSON","parse","code","message","err","checkDicomFile","arrayBuffer","length","arr","Uint8Array","slice","Array","from","every","char","i","charCodeAt","CancellationToken","this","cancelled","value","files","url","uploadCallback","cancellationToken","CHUNK_SIZE","MAX_PARALLEL_JOBS","filesArray","Error","parallelJobsCount","min","completed","processJob","resolve","reject","get","chunk","simpleUpload","forEach","file","fileId","Promise","client","getClient","readFile","loadedFile","content","storeInstances","datasets","reader","FileReader","onload","name","type","result","onerror","readAsArrayBuffer","func","retrieveAuthHeaderFunc","headers","errorHandler","getHTTPErrorHandler","api","DICOMwebClient","DicomUploader","status","isCancelled","errorsCount","uploadedVolume","wholeVolumeStr","isFilesListHidden","timeLeft","uploadedList","totalCount","successfullyUploadedCount","lastFile","uploadContext","target","filesDict","fileDesc","id","path","webkitRelativePath","processed","processedInUI","wholeVolume","map","f","reduce","a","b","random","setState","dicomUploader","setRetrieveAuthHeaderFunction","props","retrieveAuthHeaderFunction","smartUpload","state","call","style","color","key","className","parseInt","Object","keys","errors","push","htmlFor","src","alt","onChange","uploadFiles","multiple","webkitdirectory","mozdirectory","percents","filesLeft","renderTableRow","Component","PropTypes","string","event","DicomFileUploaderModal","uploaded","show","isOpen","onHide","onClose","aria-labelledby","backdrop","keyboard","Header","closeButton","Title","t","Body","withTranslation","isActive","active","ConnectedDicomFileUploader","connect","activeServer","servers","find","OHIF","DICOMWeb","getAuthorizationHeader","qidoRoot","DicomStoreList","search","store","highlightedItem","onMouseEnter","onHighlightItem","onClick","onSelect","split","loading","stores","filter","loadingIcon","body","toLowerCase","includes","array","bool","isRequired","DicomStorePicker","locations","filterStr","setAccessToken","accessToken","loadDicomStores","dataset","isError","data","dicomStores","e","object","DatasetsList","DatasetPicker","loadDatasets","project","projectId","location","locationId","ProjectsList","projects","lowerCaseFilter","filteredProjects","ProjectPicker","loadProjects","LocationsList","LocationPicker","loadLocations","DatasetSelector","unloading","dicomStoreJson","dicomStore","parts","wadoUriRoot","GoogleCloudApi","urlBase","wadoRoot","setServers","user","access_token","onProjectClick","onLocationClick","onDatasetClick","onProjectSelect","onLocationSelect","onDatasetSelect","onDicomStoreSelect","projectBreadcrumbs","canClose","DicomStorePickerModal","UIModalService","servicesManager","services","Fragment","title","contentProps","GoogleCloudUtilServers","dicomstore","hide","propTypes","ConnectedDicomStorePicker","oidc","dispatch","UrlUtil","utils","urlUtil","StudyListRoute","history","server","studyListFunctionsEnabled","useTranslation","useState","fieldName","direction","sort","setSort","studyDateTo","studyDateFrom","PatientName","PatientID","AccessionNumber","StudyDate","modalities","StudyDescription","patientNameOrId","accessionOrModalityOrDescription","allFields","filterValues","setFilterValues","studies","setStudies","isSearchingForStudies","searchStatus","setSearchStatus","activeModalId","setActiveModalId","rowsPerPage","setRowsPerPage","pageNumber","setPageNumber","appContext","useContext","AppContext","displaySize","useMedia","debouncedSort","useDebounce","debouncedFilters","appConfig","enableGoogleCloudAdapter","useEffect","getStudyList","console","warn","isFetching","fetchStudies","stringify","healthCareApiButtons","healthCareApiWindows","isModalOpen","listPath","RoutesUtil","paramString","isValidPath","pathname","replace","updateURL","padding","ConnectedDicomFilesUploader","WhiteLabelingContext","Consumer","whiteLabeling","UserManagerContext","userManager","ConnectedHeader","useLargeLogo","createLogoComponentFn","React","fontWeight","fontSize","onImport","isLoading","hasError","onSelectItem","studyInstanceUID","viewerPath","studyInstanceUIDs","onSort","sortFieldName","sortDirection","onFilterChange","studyListDateFilterNumDays","currentPage","nextPageFunc","prevPageFunc","onRowsPerPageChange","Rows","recordCount","filters","moment","subtract","toDate","Date","mappedFilters","ModalitiesInStudy","limit","offset","fuzzymatching","supportsFuzzyMatching","_fetchStudies","mappedStudies","study","undefined","StudyInstanceUID","sortedStudies","_sortStudies","numToTake","field","order","isValid","format","fieldA","fieldB","toISOString","queryFiltersArray","firstSet","_getQueryFiltersForValue","secondSet","concat","queryPromises","searchStudiesPromise","searchStudies","all","lotsOfStudies","arrayOfStudies","some","s","fields","queryFilters","assign","defaultProps","withRouter","ConnectedStudyList","StudyListRouting","routeMatch","match","routeLocation","params","seriesInstanceUIDs","useServer","queryString","getQueryFilters","shape","usePrevious","ref","useRef","current","urlStr","config","URL","URLSearchParams","fetch","fetchConfig","json","nextPageToken","pageToken","doRequest","subPage","hasOwnProperty","urlBaseProject","method","Authorization","healthcareApiEndpoint","getServers","imageRendering","thumbnailRendering","qidoSupportsIncludeField","isValidServer","isEqualServer","toCompare","serverLength","toCompareLength","getActiveServer","pathUrl","getUrlBaseDicomWeb","useServerFromUrl","previousServers","urlBasedServers","serverHasChanged","newServer","exists","bind","useSelector","useDispatch","FileLoader","imageId","image","PDFFileLoader","cornerstoneWADOImageLoader","wadouri","loadFileRequest","getDefaultStudy","StudyTime","ReferringPhysicianName","PatientBirthdate","PatientSex","StudyId","series","SeriesInstanceUID","SeriesDescription","SeriesNumber","instances","metadata","SOPInstanceUID","SOPClassUID","Columns","NumberOfFrames","InstanceNumber","getImageId","isLocalFile","metadataProvider","cornerstone","DICOMFileLoader","dicomData","dcmjs","DicomMessage","DicomMetaDictionary","naturalizeDataset","dict","addInstance","_meta","namifyDataset","meta","getStudyFromDataset","PatientBirthDate","StudyID","instance","FileLoaderService","fileType","loader","getLoader","groupBy","list","groupByKey","listKey","nonKeyCounter","acc","obj","values","studyGroup","seriesGrouped","fileManager","add","loadFile","getDataset","getStudies","processFile","fileLoaderService","addFile","filesToStudies","processFilesPromises","groupSeries","flat"],"mappings":"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","file":"StudyListRouting.bundle.1b6a8298e94df315ae5d.js","sourcesContent":["export function formatFileSize(size) {\r\n  if (size === 0) return '0 B';\r\n  const n = Math.floor(Math.log(size) / Math.log(1024));\r\n  return (\r\n    (size / Math.pow(1024, n)).toFixed(2) * 1 +\r\n    ' ' +\r\n    ['B', 'kB', 'MB', 'GB', 'TB'][n]\r\n  );\r\n}\r\n\r\nexport function httpErrorToStr(error) {\r\n  if (!error) return 'Unknown error';\r\n  if (error.response) {\r\n    try {\r\n      const jsonResponse = JSON.parse(error.response);\r\n      if (\r\n        jsonResponse.error &&\r\n        jsonResponse.error.code &&\r\n        jsonResponse.error.message\r\n      )\r\n        return jsonResponse.error.code + ' - ' + jsonResponse.error.message;\r\n    } catch (err) {\r\n      return error.response;\r\n    }\r\n  }\r\n  return error.message || 'Unknown error.';\r\n}\r\n\r\n/* eslint-disable */\r\nexport function checkDicomFile(arrayBuffer) {\r\n  if (arrayBuffer.length <= 132) return false;\r\n  const arr = new Uint8Array(arrayBuffer.slice(128, 132));\r\n  // bytes from 128 to 132 must be \"DICM\"\r\n  return Array.from('DICM').every((char, i) => char.charCodeAt(0) === arr[i]);\r\n}\r\n","export default class CancellationToken {\r\n  constructor() {\r\n    this.cancelled = false;\r\n  }\r\n\r\n  get() {\r\n    return this.cancelled;\r\n  }\r\n\r\n  set(value) {\r\n    this.cancelled = value;\r\n  }\r\n}\r\n","import { httpErrorToStr, checkDicomFile } from '../utils/helpers';\r\nimport { api } from 'dicomweb-client';\r\nimport { errorHandler } from '@ohif/core';\r\n\r\nclass DicomUploadService {\r\n  async smartUpload(files, url, uploadCallback, cancellationToken) {\r\n    const CHUNK_SIZE = 1; // Only one file per request is supported so far\r\n    const MAX_PARALLEL_JOBS = 50; // FIXME: tune MAX_PARALLEL_JOBS number\r\n\r\n    let filesArray = Array.from(files);\r\n    if (filesArray.length === 0) {\r\n      throw new Error('No files were provided.');\r\n    }\r\n\r\n    let parallelJobsCount = Math.min(filesArray.length, MAX_PARALLEL_JOBS);\r\n    let completed = false;\r\n\r\n    const processJob = async (resolve, reject) => {\r\n      while (filesArray.length > 0) {\r\n        if (cancellationToken.get()) return;\r\n        let chunk = filesArray.slice(0, CHUNK_SIZE);\r\n        filesArray = filesArray.slice(CHUNK_SIZE);\r\n        let error = null;\r\n        try {\r\n          if (chunk.length > 1) throw new Error('Not implemented');\r\n          if (chunk.length === 1) await this.simpleUpload(chunk[0], url);\r\n        } catch (err) {\r\n          // It looks like a stupid bug of Babel that err is not an actual Exception object\r\n          error = httpErrorToStr(err);\r\n        }\r\n        chunk.forEach(file => uploadCallback(file.fileId, error));\r\n        if (!completed && filesArray.length === 0) {\r\n          completed = true;\r\n          resolve();\r\n          return;\r\n        }\r\n      }\r\n    };\r\n\r\n    await new Promise(resolve => {\r\n      for (let i = 0; i < parallelJobsCount; i++) {\r\n        processJob(resolve);\r\n      }\r\n    });\r\n  }\r\n\r\n  async simpleUpload(file, url) {\r\n    const client = this.getClient(url);\r\n    const loadedFile = await this.readFile(file);\r\n    const content = loadedFile.content;\r\n    if (!checkDicomFile(content))\r\n      throw new Error('This is not a valid DICOM file.');\r\n\r\n    await client.storeInstances({ datasets: [content] });\r\n  }\r\n\r\n  readFile(file) {\r\n    return new Promise((resolve, reject) => {\r\n      const reader = new FileReader();\r\n      reader.onload = () => {\r\n        resolve({\r\n          name: file.name,\r\n          size: file.size,\r\n          type: file.type,\r\n          content: reader.result,\r\n        });\r\n      };\r\n      reader.onerror = error => reject(error);\r\n      reader.readAsArrayBuffer(file);\r\n    });\r\n  }\r\n\r\n  setRetrieveAuthHeaderFunction(func) {\r\n    this.retrieveAuthHeaderFunc = func;\r\n  }\r\n\r\n  getClient(url) {\r\n    const headers = this.retrieveAuthHeaderFunc();\r\n    const errorInterceptor = errorHandler.getHTTPErrorHandler();\r\n\r\n    // TODO: a bit weird we are creating a new dicomweb client instance for every upload\r\n    return new api.DICOMwebClient({\r\n      url,\r\n      headers,\r\n    });\r\n  }\r\n}\r\n\r\nexport default new DicomUploadService();\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { formatFileSize } from './utils/helpers';\r\nimport CancellationToken from './utils/CancellationToken';\r\nimport dicomUploader from './api/DicomUploadService';\r\nimport './DicomUploader.css';\r\n\r\nexport default class DicomUploader extends Component {\r\n  state = {\r\n    status: 'Upload',\r\n    isCancelled: false,\r\n    errorsCount: 0,\r\n    files: null,\r\n    uploadedVolume: null,\r\n    wholeVolumeStr: null,\r\n    isFilesListHidden: true,\r\n    timeLeft: null,\r\n    uploadedList: null,\r\n    totalCount: 0,\r\n    successfullyUploadedCount: 0,\r\n    lastFile: '',\r\n    uploadContext: null, // this is probably not needed, but we use this variable to distinguish between different downloads\r\n  };\r\n\r\n  static propTypes = {\r\n    id: PropTypes.string,\r\n    event: PropTypes.string,\r\n    url: PropTypes.string,\r\n    retrieveAuthHeaderFunction: PropTypes.func,\r\n  };\r\n\r\n  filesLeft() {\r\n    return (\r\n      this.state.uploadedList.length + ' of ' + this.state.totalCount + ' files'\r\n    );\r\n  }\r\n\r\n  volumeLeft() {\r\n    let left = formatFileSize(this.state.uploadedVolume);\r\n    return left + ' of ' + this.state.wholeVolumeStr;\r\n  }\r\n\r\n  percents() {\r\n    return parseInt(\r\n      (100 * this.state.uploadedList.length) /\r\n        Object.keys(this.state.files).length\r\n    );\r\n  }\r\n\r\n  isFinished() {\r\n    return (\r\n      this.state.isCancelled ||\r\n      Object.keys(this.state.files).length === this.state.uploadedList.length\r\n    );\r\n  }\r\n\r\n  errorsMessage() {\r\n    const errors = this.state.errorsCount === 1 ? ' error' : ' errors';\r\n    return (\r\n      this.state.errorsCount + errors + ' while uploading, click for more info'\r\n    );\r\n  }\r\n\r\n  uploadFiles = files => {\r\n    const filesArray = Array.from(files.target.files);\r\n    const filesDict = {};\r\n    filesArray.forEach((file, i) => {\r\n      const fileDesc = {\r\n        id: i,\r\n        name: file.name,\r\n        path: file.webkitRelativePath || file.name,\r\n        size: file.size,\r\n        error: null,\r\n        processed: false,\r\n        processedInUI: false,\r\n      };\r\n      filesDict[i] = fileDesc;\r\n      file.fileId = i;\r\n    });\r\n    const wholeVolume = filesArray.map(f => f.size).reduce((a, b) => a + b);\r\n    const uploadContext = Math.random();\r\n    this.setState({\r\n      status: 'Uploading...',\r\n      files: filesDict,\r\n      uploadedList: [],\r\n      uploadedVolume: 0,\r\n      lastFile: filesArray[0].name,\r\n      totalCount: filesArray.length,\r\n      wholeVolumeStr: formatFileSize(wholeVolume),\r\n      uploadContext: uploadContext,\r\n      cancellationToken: new CancellationToken(),\r\n    });\r\n    const cancellationToken = new CancellationToken();\r\n    const uploadCallback = (fileId, error) =>\r\n      uploadContext === this.state.uploadContext &&\r\n      this.uploadCallback.call(this, fileId, error);\r\n\r\n    dicomUploader.setRetrieveAuthHeaderFunction(this.props.retrieveAuthHeaderFunction);\r\n\r\n    dicomUploader.smartUpload(\r\n      files.target.files,\r\n      this.props.url,\r\n      uploadCallback,\r\n      cancellationToken\r\n    );\r\n  };\r\n\r\n  uploadCallback(fileId, error) {\r\n    const file = this.state.files[fileId];\r\n    file.processed = true;\r\n    if (!error) {\r\n      let uploadedVolume = this.state.uploadedVolume + file.size;\r\n      this.setState({ uploadedVolume });\r\n    } else {\r\n      file.error = error;\r\n      this.setState({ errorsCount: this.state.errorsCount + 1 });\r\n    }\r\n    this.setState({ lastFile: file.name });\r\n    let uploadedList = this.state.uploadedList;\r\n    uploadedList.push(file);\r\n    this.setState({ uploadedList });\r\n  }\r\n\r\n  renderTableRow = file => {\r\n    let error = null;\r\n    if (file.error !== null) {\r\n      error = <p style={{ color: 'red' }}>{file.error}</p>;\r\n    }\r\n    return (\r\n      <tr key={file.id}>\r\n        <td className=\"project\">\r\n          {file.name} {error}\r\n        </td>\r\n      </tr>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    if (this.state.files === null) {\r\n      return (\r\n        <div className=\"dicom-uploader\">\r\n          <div className=\"button\">\r\n            <label htmlFor=\"file\">\r\n              <img src=\"./assets/Button_File.svg\" alt=\"upload file\"></img>\r\n            </label>\r\n            <input\r\n              className=\"invisible-input\"\r\n              onChange={this.uploadFiles}\r\n              type=\"file\"\r\n              id=\"file\"\r\n              multiple\r\n            />\r\n          </div>\r\n\r\n          <div className=\"button\">\r\n            <label htmlFor=\"folder\">\r\n              <img src=\"./assets/Button_Folder.svg\" alt=\"upload folder\"></img>\r\n            </label>\r\n            <input\r\n              className=\"invisible-input\"\r\n              type=\"file\"\r\n              onChange={this.uploadFiles}\r\n              id=\"folder\"\r\n              webkitdirectory=\"true\"\r\n              mozdirectory=\"true\"\r\n              multiple\r\n            />\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <table id=\"tblProjectList\" className=\"table noselect\">\r\n        <thead>\r\n          <tr>\r\n            <th className=\"table-header\">\r\n              {this.percents()}% {this.filesLeft()}\r\n            </th>\r\n          </tr>\r\n        </thead>\r\n        <tbody id=\"ProjectList\">\r\n          {this.state.uploadedList.map(this.renderTableRow)}\r\n        </tbody>\r\n      </table>\r\n    );\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Modal from 'react-bootstrap-modal';\r\nimport DicomUploader from './DicomUploader';\r\nimport { withTranslation } from 'react-i18next';\r\n\r\nclass DicomFileUploaderModal extends Component {\r\n  static propTypes = {\r\n    url: PropTypes.string,\r\n    retrieveAuthHeaderFunction: PropTypes.func,\r\n    onClose: PropTypes.func,\r\n  };\r\n\r\n  state = {\r\n    uploaded: false,\r\n  };\r\n\r\n  render() {\r\n    if (!this.props.url) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <Modal\r\n        show={this.props.isOpen}\r\n        onHide={this.props.onClose}\r\n        aria-labelledby=\"ModalHeader\"\r\n        className=\"modal fade themed in\"\r\n        backdrop={false}\r\n        size={'md'}\r\n        keyboard={true}\r\n      >\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>\r\n            {this.props.t('Upload DICOM Files')}\r\n          </Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <DicomUploader\r\n            url={this.props.url}\r\n            retrieveAuthHeaderFunction={this.props.retrieveAuthHeaderFunction}\r\n          />\r\n        </Modal.Body>\r\n      </Modal>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withTranslation('Common')(DicomFileUploaderModal);\r\n","import { connect } from 'react-redux';\r\nimport DicomFileUploaderModal from './DicomFileUploaderModal.js';\r\nimport OHIF from '@ohif/core';\r\n\r\nconst isActive = a => a.active === true;\r\n\r\nconst mapStateToProps = state => {\r\n  const activeServer = state.servers.servers.find(isActive);\r\n\r\n  // TODO: Not sure I like this approach since it means we are recreating\r\n  // this function every time redux changes\r\n  const retrieveAuthHeaderFunction = () =>\r\n    OHIF.DICOMWeb.getAuthorizationHeader(activeServer);\r\n\r\n  return {\r\n    retrieveAuthHeaderFunction,\r\n    url: activeServer && activeServer.qidoRoot,\r\n  };\r\n};\r\n\r\nconst ConnectedDicomFileUploader = connect(\r\n  mapStateToProps,\r\n  null\r\n)(DicomFileUploaderModal);\r\n\r\nexport default ConnectedDicomFileUploader;\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport './googleCloud.css';\r\nimport { withTranslation } from 'react-i18next';\r\nimport { Icon } from '@ohif/ui';\r\n\r\nclass DicomStoreList extends Component {\r\n  state = {\r\n    search: '',\r\n  };\r\n\r\n  static propTypes = {\r\n    stores: PropTypes.array,\r\n    loading: PropTypes.bool.isRequired,\r\n    error: PropTypes.string,\r\n    onSelect: PropTypes.func,\r\n  };\r\n\r\n  static defaultProps = {\r\n    loading: true,\r\n  };\r\n\r\n  renderTableRow = store => {\r\n    return (\r\n      <tr\r\n        key={store.name}\r\n        className={\r\n          this.state.highlightedItem === store.name\r\n            ? 'noselect active'\r\n            : 'noselect'\r\n        }\r\n        onMouseEnter={() => {\r\n          this.onHighlightItem(store.name);\r\n        }}\r\n        onClick={() => {\r\n          this.props.onSelect(store);\r\n        }}\r\n      >\r\n        <td className=\"project\">{store.name.split('/')[7]}</td>\r\n      </tr>\r\n    );\r\n  };\r\n\r\n  onHighlightItem(store) {\r\n    this.setState({ highlightedItem: store });\r\n  }\r\n\r\n  render() {\r\n    const { loading, stores, filter, error } = this.props;\r\n\r\n    if (error) {\r\n      return <p>{error}</p>;\r\n    }\r\n\r\n    const loadingIcon = (\r\n      <Icon name=\"circle-notch\" className=\"loading-icon-spin loading-icon\" />\r\n    );\r\n\r\n    if (loading) {\r\n      return loadingIcon;\r\n    }\r\n\r\n    const body = (\r\n      <tbody id=\"StoreList\">{\r\n        stores.filter(store => (store.name.split('/')[7].toLowerCase().includes(filter.toLowerCase()) || filter==\"\")).map(this.renderTableRow)}\r\n      </tbody>\r\n    );\r\n\r\n    return (\r\n      <table id=\"tblStoreList\" className=\"gcp-table table noselect\">\r\n        <thead>\r\n          <tr>\r\n            <th>{this.props.t('DICOM Store')}</th>\r\n          </tr>\r\n        </thead>\r\n        {stores && body}\r\n      </table>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withTranslation('Common')(DicomStoreList);\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport api from './api/GoogleCloudApi';\r\nimport DicomStoreList from './DicomStoreList';\r\nimport './googleCloud.css';\r\n\r\nexport default class DicomStorePicker extends Component {\r\n  state = {\r\n    error: null,\r\n    loading: true,\r\n    stores: [],\r\n    locations: [],\r\n    filterStr: '',\r\n  };\r\n\r\n  static propTypes = {\r\n    dataset: PropTypes.object,\r\n    onSelect: PropTypes.func,\r\n    accessToken: PropTypes.string.isRequired,\r\n  };\r\n\r\n  async componentDidMount() {\r\n    api.setAccessToken(this.props.accessToken);\r\n\r\n    const response = await api.loadDicomStores(this.props.dataset.name);\r\n\r\n    if (response.isError) {\r\n      this.setState({\r\n        error: response.message,\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    this.setState({\r\n      stores: response.data.dicomStores || [],\r\n      loading: false,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { stores, loading, error, filterStr } = this.state;\r\n    const { onSelect } = this.props;\r\n\r\n    return (\r\n      <div>\r\n        <input\r\n          className=\"form-control gcp-input\"\r\n          type=\"text\"\r\n          value={filterStr}\r\n          onChange={e => this.setState({ filterStr: e.target.value })}\r\n        />\r\n        <DicomStoreList\r\n          stores={stores}\r\n          loading={loading}\r\n          error={error}\r\n          filter={filterStr}\r\n          onSelect={onSelect}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport './googleCloud.css';\r\nimport { withTranslation } from 'react-i18next';\r\nimport { Icon } from '@ohif/ui';\r\n\r\nclass DatasetsList extends Component {\r\n  state = {\r\n    search: '',\r\n  };\r\n\r\n  static propTypes = {\r\n    datasets: PropTypes.array,\r\n    loading: PropTypes.bool,\r\n    error: PropTypes.string,\r\n    onSelect: PropTypes.func,\r\n  };\r\n\r\n  static defaultProps = {\r\n    loading: true,\r\n  };\r\n\r\n  renderTableRow = dataset => {\r\n    return (\r\n      <tr\r\n        key={dataset.name}\r\n        className={\r\n          this.state.highlightedItem === dataset.name\r\n            ? 'noselect active'\r\n            : 'noselect'\r\n        }\r\n        onMouseEnter={() => {\r\n          this.onHighlightItem(dataset.name);\r\n        }}\r\n        onClick={() => {\r\n          this.props.onSelect(dataset);\r\n        }}\r\n      >\r\n        <td>{dataset.name.split('/')[5]}</td>\r\n      </tr>\r\n    );\r\n  };\r\n\r\n  onHighlightItem(dataset) {\r\n    this.setState({ highlightedItem: dataset });\r\n  }\r\n\r\n  render() {\r\n    const { loading, datasets, filter, error } = this.props;\r\n    \r\n    if (error) {\r\n      return <p>{error}</p>;\r\n    }\r\n\r\n    const loadingIcon = (\r\n      <Icon name=\"circle-notch\" className=\"loading-icon-spin loading-icon\" />\r\n    );\r\n\r\n    if (loading) {\r\n      return loadingIcon;\r\n    }\r\n\r\n    const body = (\r\n      <tbody id=\"DatasetList\">\r\n        {datasets.filter(dataset => (dataset.name.split('/')[5].toLowerCase().includes(filter.toLowerCase()) || filter==\"\")).map(this.renderTableRow)}\r\n      </tbody>\r\n    );\r\n\r\n    return (\r\n      <table id=\"tblDatasetList\" className=\"gcp-table table noselect\">\r\n        <thead>\r\n          <tr>\r\n            <th>{this.props.t('Dataset')}</th>\r\n          </tr>\r\n        </thead>\r\n        {datasets && body}\r\n      </table>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withTranslation('Common')(DatasetsList);\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport api from './api/GoogleCloudApi';\r\nimport DatasetsList from './DatasetsList';\r\nimport './googleCloud.css';\r\n\r\nexport default class DatasetPicker extends Component {\r\n  state = {\r\n    error: null,\r\n    loading: true,\r\n    datasets: [],\r\n    filterStr: '',\r\n  };\r\n\r\n  static propTypes = {\r\n    project: PropTypes.object,\r\n    location: PropTypes.object,\r\n    onSelect: PropTypes.func,\r\n    accessToken: PropTypes.string,\r\n  };\r\n\r\n  async componentDidMount() {\r\n    api.setAccessToken(this.props.accessToken);\r\n\r\n    const response = await api.loadDatasets(\r\n      this.props.project.projectId,\r\n      this.props.location.locationId\r\n    );\r\n\r\n    if (response.isError) {\r\n      this.setState({\r\n        error: response.message,\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    this.setState({\r\n      datasets: response.data.datasets || [],\r\n      loading: false,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { datasets, loading, error, filterStr } = this.state;\r\n    const { onSelect } = this.props;\r\n    return (\r\n      <div>\r\n        <input\r\n          className=\"form-control gcp-input\"\r\n          type=\"text\"\r\n          value={filterStr}\r\n          onChange={e => this.setState({ filterStr: e.target.value })}\r\n        />\r\n        <DatasetsList\r\n          datasets={datasets}\r\n          loading={loading}\r\n          error={error}\r\n          filter={filterStr}\r\n          onSelect={onSelect}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport './googleCloud.css';\r\nimport { withTranslation } from 'react-i18next';\r\nimport { Icon } from '@ohif/ui';\r\n\r\nclass ProjectsList extends Component {\r\n  state = {\r\n    search: '',\r\n    highlightedItem: null,\r\n  };\r\n\r\n  static propTypes = {\r\n    projects: PropTypes.array,\r\n    loading: PropTypes.bool.isRequired,\r\n    error: PropTypes.string,\r\n    onSelect: PropTypes.func.isRequired,\r\n    t: PropTypes.func,\r\n  };\r\n\r\n  static defaultProps = {\r\n    loading: true,\r\n  };\r\n\r\n  renderTableRow = project => {\r\n    return (\r\n      <tr\r\n        key={project.projectId}\r\n        className={\r\n          this.state.highlightedItem === project.projectId\r\n            ? 'noselect active'\r\n            : 'noselect'\r\n        }\r\n        onMouseEnter={() => {\r\n          this.onHighlightItem(project.projectId);\r\n        }}\r\n        onClick={() => {\r\n          this.onHighlightItem(project.projectId);\r\n          this.props.onSelect(project);\r\n        }}\r\n      >\r\n        <td>{project.name}</td>\r\n        <td>{project.projectId}</td>\r\n      </tr>\r\n    );\r\n  };\r\n\r\n  onHighlightItem(project) {\r\n    this.setState({ highlightedItem: project });\r\n  }\r\n\r\n  render() {\r\n    const { loading, projects, filter, error } = this.props;\r\n\r\n    if (error) {\r\n      return <p>{error}</p>;\r\n    }\r\n\r\n    const loadingIcon = (\r\n      <Icon name=\"circle-notch\" className=\"loading-icon-spin loading-icon\" />\r\n    );\r\n\r\n    if (loading) {\r\n      return loadingIcon;\r\n    }\r\n\r\n    const lowerCaseFilter = filter.toLowerCase();\r\n    const filteredProjects = projects.filter(project =>   \r\n      typeof project.name  === 'string' &&\r\n      (filter === \"\" || project.name.toLowerCase().includes(lowerCaseFilter))\r\n    );\r\n\r\n    const body = (\r\n      <tbody id=\"ProjectList\">\r\n        {\r\n          filteredProjects.map(this.renderTableRow)\r\n        }\r\n      </tbody>\r\n    );\r\n\r\n    return (\r\n      <table id=\"tblProjectList\" className=\"gcp-table table noselect\">\r\n        <thead>\r\n          <tr>\r\n            <th>{this.props.t('Project')}</th>\r\n            <th>{this.props.t('ID')}</th>\r\n          </tr>\r\n        </thead>\r\n        {projects && body}\r\n      </table>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withTranslation('Common')(ProjectsList);\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport api from './api/GoogleCloudApi';\r\nimport ProjectsList from './ProjectsList';\r\nimport './googleCloud.css';\r\n\r\nexport default class ProjectPicker extends Component {\r\n  state = {\r\n    error: null,\r\n    loading: true,\r\n    projects: [],\r\n  };\r\n\r\n  static propTypes = {\r\n    onSelect: PropTypes.func,\r\n    accessToken: PropTypes.string,\r\n  };\r\n\r\n  async componentDidMount() {\r\n    api.setAccessToken(this.props.accessToken);\r\n    const response = await api.loadProjects();\r\n\r\n    if (response.isError) {\r\n      this.setState({\r\n        error: response.message,\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    this.setState({\r\n      projects: response.data.projects || [],\r\n      filterStr: '',\r\n      loading: false,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { projects, loading, filterStr, error } = this.state;\r\n    const { onSelect } = this.props;\r\n    return (\r\n      <div>\r\n        <input\r\n          className=\"form-control gcp-input\"\r\n          type=\"text\"\r\n          value={filterStr}\r\n          onChange={e => this.setState({ filterStr: e.target.value })}\r\n        />\r\n        <ProjectsList\r\n          projects={projects}\r\n          loading={loading}\r\n          filter={filterStr}\r\n          error={error}\r\n          onSelect={onSelect}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport './googleCloud.css';\r\nimport { withTranslation } from 'react-i18next';\r\nimport { Icon } from '@ohif/ui';\r\n\r\nclass LocationsList extends Component {\r\n  state = {\r\n    search: '',\r\n  };\r\n\r\n  static propTypes = {\r\n    locations: PropTypes.array,\r\n    loading: PropTypes.bool.isRequired,\r\n    error: PropTypes.string,\r\n    onSelect: PropTypes.func,\r\n  };\r\n\r\n  static defaultProps = {\r\n    loading: true,\r\n  };\r\n\r\n  renderTableRow = location => {\r\n    return (\r\n      <tr\r\n        key={location.locationId}\r\n        className={\r\n          this.state.highlightedItem === location.locationId\r\n            ? 'noselect active'\r\n            : 'noselect'\r\n        }\r\n        onMouseEnter={() => {\r\n          this.onHighlightItem(location.locationId);\r\n        }}\r\n        onClick={() => {\r\n          this.props.onSelect(location);\r\n        }}\r\n      >\r\n        <td>{location.name.split('/')[3]}</td>\r\n      </tr>\r\n    );\r\n  };\r\n\r\n  onHighlightItem(locationId) {\r\n    this.setState({ highlightedItem: locationId });\r\n  }\r\n\r\n  render() {\r\n    const { loading, locations, filter, error } = this.props;\r\n\r\n    if (error) {\r\n      return <p>{error}</p>;\r\n    }\r\n\r\n    const loadingIcon = (\r\n      <Icon name=\"circle-notch\" className=\"loading-icon-spin loading-icon\" />\r\n    );\r\n\r\n    if (loading) {\r\n      return loadingIcon;\r\n    }\r\n\r\n    const body = (\r\n      <tbody id=\"LocationList\">\r\n        {locations.filter(location => (location.name.split('/')[3].toLowerCase().includes(filter.toLowerCase()) || filter==\"\")).map(this.renderTableRow)}\r\n      </tbody>\r\n    );\r\n\r\n    return (\r\n      <table id=\"tblLocationList\" className=\"gcp-table table noselect\">\r\n        <thead>\r\n          <tr>\r\n            <th>{this.props.t('Location')}</th>\r\n          </tr>\r\n        </thead>\r\n        {locations && body}\r\n      </table>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withTranslation('Common')(LocationsList);\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport api from './api/GoogleCloudApi';\r\nimport LocationsList from './LocationsList';\r\nimport './googleCloud.css';\r\n\r\nexport default class LocationPicker extends Component {\r\n  state = {\r\n    error: null,\r\n    loading: true,\r\n    locations: [],\r\n    filterStr: '',\r\n  };\r\n\r\n  static propTypes = {\r\n    project: PropTypes.object,\r\n    onSelect: PropTypes.func,\r\n    accessToken: PropTypes.string,\r\n  };\r\n\r\n  async componentDidMount() {\r\n    api.setAccessToken(this.props.accessToken);\r\n\r\n    const response = await api.loadLocations(this.props.project.projectId);\r\n\r\n    if (response.isError) {\r\n      this.setState({\r\n        error: response.message,\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    this.setState({\r\n      locations: response.data.locations || [],\r\n      loading: false,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { locations, loading, error, filterStr } = this.state;\r\n    const { onSelect } = this.props;\r\n    return (\r\n      <div>\r\n        <input\r\n          className=\"form-control gcp-input\"\r\n          type=\"text\"\r\n          value={filterStr}\r\n          onChange={e => this.setState({ filterStr: e.target.value })}\r\n        />\r\n        <LocationsList\r\n          locations={locations}\r\n          loading={loading}\r\n          error={error}\r\n          filter={filterStr}\r\n          onSelect={onSelect}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { withTranslation } from 'react-i18next';\r\nimport DicomStorePicker from './DicomStorePicker';\r\nimport DatasetPicker from './DatasetPicker';\r\nimport ProjectPicker from './ProjectPicker';\r\nimport LocationPicker from './LocationPicker';\r\nimport GoogleCloudApi from './api/GoogleCloudApi';\r\nimport './googleCloud.css';\r\n\r\nclass DatasetSelector extends Component {\r\n  state = {\r\n    project: null,\r\n    location: null,\r\n    dataset: null,\r\n    unloading: false,\r\n  };\r\n\r\n  static propTypes = {\r\n    id: PropTypes.string,\r\n    event: PropTypes.string,\r\n    user: PropTypes.object,\r\n    canClose: PropTypes.string,\r\n    setServers: PropTypes.func.isRequired,\r\n  };\r\n\r\n  onProjectSelect = project => {\r\n    this.setState({\r\n      project,\r\n    });\r\n  };\r\n\r\n  onLocationSelect = location => {\r\n    this.setState({\r\n      location,\r\n    });\r\n  };\r\n\r\n  onDatasetSelect = dataset => {\r\n    this.setState({\r\n      dataset,\r\n    });\r\n  };\r\n\r\n  onProjectClick = () => {\r\n    this.setState({\r\n      dataset: null,\r\n      location: null,\r\n      project: null,\r\n    });\r\n  };\r\n\r\n  onLocationClick = () => {\r\n    this.setState({\r\n      dataset: null,\r\n      location: null,\r\n    });\r\n  };\r\n\r\n  onDatasetClick = () => {\r\n    this.setState({\r\n      dataset: null,\r\n    });\r\n  };\r\n\r\n  onDicomStoreSelect = dicomStoreJson => {\r\n    const dicomStore = dicomStoreJson.name;\r\n    const parts = dicomStore.split('/');\r\n    const result = {\r\n      wadoUriRoot: GoogleCloudApi.urlBase + `/${dicomStore}/dicomWeb`,\r\n      qidoRoot: GoogleCloudApi.urlBase + `/${dicomStore}/dicomWeb`,\r\n      wadoRoot: GoogleCloudApi.urlBase + `/${dicomStore}/dicomWeb`,\r\n      project: parts[1],\r\n      location: parts[3],\r\n      dataset: parts[5],\r\n      dicomStore: parts[7],\r\n    };\r\n    this.props.setServers(result);\r\n  };\r\n\r\n  render() {\r\n    const accessToken = this.props.user.access_token;\r\n\r\n    const { project, location, dataset } = this.state;\r\n    const {\r\n      onProjectClick,\r\n      onLocationClick,\r\n      onDatasetClick,\r\n      onProjectSelect,\r\n      onLocationSelect,\r\n      onDatasetSelect,\r\n      onDicomStoreSelect,\r\n    } = this;\r\n\r\n    let projectBreadcrumbs = (\r\n      <div className=\"gcp-picker--path\">\r\n        <span>{this.props.t('Select a Project')}</span>\r\n      </div>\r\n    );\r\n\r\n    if (project) {\r\n      projectBreadcrumbs = (\r\n        <div className=\"gcp-picker--path\">\r\n          <span onClick={onProjectClick}>{project.name}</span>\r\n          {project && location && (\r\n            <span onClick={onLocationClick}>\r\n              {' '}\r\n              -> {location.name.split('/')[3]}\r\n            </span>\r\n          )}\r\n          {project && location && dataset && (\r\n            <span onClick={onDatasetClick}>\r\n              {' '}\r\n              -> {dataset.name.split('/')[5]}\r\n            </span>\r\n          )}\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <>\r\n        {projectBreadcrumbs}\r\n        {!project && (\r\n          <ProjectPicker accessToken={accessToken} onSelect={onProjectSelect} />\r\n        )}\r\n\r\n        {project && !location && (\r\n          <LocationPicker\r\n            accessToken={accessToken}\r\n            project={project}\r\n            onSelect={onLocationSelect}\r\n          />\r\n        )}\r\n        {project && location && !dataset && (\r\n          <DatasetPicker\r\n            accessToken={accessToken}\r\n            project={project}\r\n            location={location}\r\n            onSelect={onDatasetSelect}\r\n          />\r\n        )}\r\n        {project && location && dataset && (\r\n          <DicomStorePicker\r\n            accessToken={accessToken}\r\n            dataset={dataset}\r\n            onSelect={onDicomStoreSelect}\r\n          />\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withTranslation('Common')(DatasetSelector);\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport DatasetSelector from './DatasetSelector';\r\nimport './googleCloud.css';\r\nimport { withTranslation } from 'react-i18next';\r\nimport * as GoogleCloudUtilServers from './utils/getServers';\r\n\r\nimport { servicesManager } from './../App.js';\r\n\r\nfunction DicomStorePickerModal({\r\n  isOpen = false,\r\n  setServers,\r\n  onClose,\r\n  user,\r\n  url,\r\n  t,\r\n}) {\r\n  const { UIModalService } = servicesManager.services;\r\n\r\n  const showDicomStorePickerModal = () => {\r\n    const handleEvent = data => {\r\n      const servers = GoogleCloudUtilServers.getServers(data, data.dicomstore);\r\n      setServers(servers);\r\n\r\n      // Force auto close\r\n      UIModalService.hide();\r\n      onClose();\r\n    };\r\n\r\n    if (UIModalService) {\r\n      UIModalService.show({\r\n        content: DatasetSelector,\r\n        title: t('Google Cloud Healthcare API'),\r\n        contentProps: {\r\n          setServers: handleEvent,\r\n          user,\r\n          url,\r\n        },\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <React.Fragment>{isOpen && showDicomStorePickerModal()}</React.Fragment>\r\n  );\r\n}\r\n\r\nDicomStorePickerModal.propTypes = {\r\n  isOpen: PropTypes.bool.isRequired,\r\n  setServers: PropTypes.func.isRequired,\r\n  onClose: PropTypes.func,\r\n  user: PropTypes.object.isRequired,\r\n  url: PropTypes.string,\r\n};\r\n\r\nexport default withTranslation('Common')(DicomStorePickerModal);\r\n","import { connect } from 'react-redux';\r\nimport DicomStorePickerModal from './DicomStorePickerModal.js';\r\n\r\nconst isActive = a => a.active === true;\r\n\r\nconst mapStateToProps = state => {\r\n  const activeServer = state.servers.servers.find(isActive);\r\n\r\n  return {\r\n    user: state.oidc && state.oidc.user,\r\n    url: activeServer && activeServer.qidoRoot,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    setServers: servers => {\r\n      const action = {\r\n        type: 'SET_SERVERS',\r\n        servers,\r\n      };\r\n      dispatch(action);\r\n    },\r\n  };\r\n};\r\n\r\nconst ConnectedDicomStorePicker = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(DicomStorePickerModal);\r\n\r\nexport default ConnectedDicomStorePicker;\r\n","import React, { useState, useEffect, useContext } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport OHIF from '@ohif/core';\r\nimport { withRouter } from 'react-router-dom';\r\nimport { useTranslation } from 'react-i18next';\r\nimport {\r\n  StudyList,\r\n  PageToolbar,\r\n  TablePagination,\r\n  useDebounce,\r\n  useMedia,\r\n} from '@ohif/ui';\r\nimport ConnectedHeader from '../connectedComponents/ConnectedHeader.js';\r\nimport * as RoutesUtil from '../routes/routesUtil';\r\nimport moment from 'moment';\r\nimport ConnectedDicomFilesUploader from '../googleCloud/ConnectedDicomFilesUploader';\r\nimport ConnectedDicomStorePicker from '../googleCloud/ConnectedDicomStorePicker';\r\nimport filesToStudies from '../lib/filesToStudies.js';\r\n\r\n// Contexts\r\nimport UserManagerContext from '../context/UserManagerContext';\r\nimport WhiteLabelingContext from '../context/WhiteLabelingContext';\r\nimport AppContext from '../context/AppContext';\r\n\r\nconst { urlUtil: UrlUtil } = OHIF.utils;\r\n\r\nfunction StudyListRoute(props) {\r\n  const { history, server, user, studyListFunctionsEnabled } = props;\r\n  const [t] = useTranslation('Common');\r\n  // ~~ STATE\r\n  const [sort, setSort] = useState({\r\n    fieldName: 'PatientName',\r\n    direction: 'desc',\r\n  });\r\n  const [filterValues, setFilterValues] = useState({\r\n    studyDateTo: null,\r\n    studyDateFrom: null,\r\n    PatientName: '',\r\n    PatientID: '',\r\n    AccessionNumber: '',\r\n    StudyDate: '',\r\n    modalities: '',\r\n    StudyDescription: '',\r\n    //\r\n    patientNameOrId: '',\r\n    accessionOrModalityOrDescription: '',\r\n    //\r\n    allFields: '',\r\n  });\r\n  const [studies, setStudies] = useState([]);\r\n  const [searchStatus, setSearchStatus] = useState({\r\n    isSearchingForStudies: false,\r\n    error: null,\r\n  });\r\n  const [activeModalId, setActiveModalId] = useState(null);\r\n  const [rowsPerPage, setRowsPerPage] = useState(25);\r\n  const [pageNumber, setPageNumber] = useState(0);\r\n  const appContext = useContext(AppContext);\r\n  // ~~ RESPONSIVE\r\n  const displaySize = useMedia(\r\n    [\r\n      '(min-width: 1750px)',\r\n      '(min-width: 1000px) and (max-width: 1749px)',\r\n      '(max-width: 999px)',\r\n    ],\r\n    ['large', 'medium', 'small'],\r\n    'small'\r\n  );\r\n  // ~~ DEBOUNCED INPUT\r\n  const debouncedSort = useDebounce(sort, 200);\r\n  const debouncedFilters = useDebounce(filterValues, 250);\r\n\r\n  // Google Cloud Adapter for DICOM Store Picking\r\n  const { appConfig = {} } = appContext;\r\n  const isGoogleCHAIntegrationEnabled =\r\n    !server && appConfig.enableGoogleCloudAdapter;\r\n  if (isGoogleCHAIntegrationEnabled && activeModalId !== 'DicomStorePicker') {\r\n    setActiveModalId('DicomStorePicker');\r\n  }\r\n\r\n  // Called when relevant state/props are updated\r\n  // Watches filters and sort, debounced\r\n  useEffect(\r\n    () => {\r\n      const fetchStudies = async () => {\r\n        try {\r\n          setSearchStatus({ error: null, isSearchingForStudies: true });\r\n\r\n          const response = await getStudyList(\r\n            server,\r\n            debouncedFilters,\r\n            debouncedSort,\r\n            rowsPerPage,\r\n            pageNumber,\r\n            displaySize\r\n          );\r\n\r\n          setStudies(response);\r\n          setSearchStatus({ error: null, isSearchingForStudies: false });\r\n        } catch (error) {\r\n          console.warn(error);\r\n          setSearchStatus({ error: true, isFetching: false });\r\n        }\r\n      };\r\n\r\n      if (server) {\r\n        fetchStudies();\r\n      }\r\n    },\r\n    // TODO: Can we update studies directly?\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    [\r\n      debouncedFilters,\r\n      debouncedSort,\r\n      rowsPerPage,\r\n      pageNumber,\r\n      displaySize,\r\n      server,\r\n    ]\r\n  );\r\n\r\n  // TODO: Update Server\r\n  // if (this.props.server !== prevProps.server) {\r\n  //   this.setState({\r\n  //     modalComponentId: null,\r\n  //     searchData: null,\r\n  //     studies: null,\r\n  //   });\r\n  // }\r\n\r\n  const onDrop = async acceptedFiles => {\r\n    try {\r\n      const studiesFromFiles = await filesToStudies(acceptedFiles);\r\n      setStudies(studiesFromFiles);\r\n    } catch (error) {\r\n      setSearchStatus({ isSearchingForStudies: false, error });\r\n    }\r\n  };\r\n\r\n  if (searchStatus.error) {\r\n    return <div>Error: {JSON.stringify(searchStatus.error)}</div>;\r\n  } else if (studies === [] && !activeModalId) {\r\n    return <div>Loading...</div>;\r\n  }\r\n\r\n  let healthCareApiButtons = null;\r\n  let healthCareApiWindows = null;\r\n\r\n  if (appConfig.enableGoogleCloudAdapter) {\r\n    const isModalOpen = activeModalId === 'DicomStorePicker';\r\n    updateURL(isModalOpen, appConfig, server, history);\r\n\r\n    healthCareApiWindows = (\r\n      <ConnectedDicomStorePicker\r\n        isOpen={activeModalId === 'DicomStorePicker'}\r\n        onClose={() => setActiveModalId(null)}\r\n      />\r\n    );\r\n\r\n    healthCareApiButtons = (\r\n      <div\r\n        className=\"form-inline btn-group pull-right\"\r\n        style={{ padding: '20px' }}\r\n      >\r\n        <button\r\n          className=\"btn btn-primary\"\r\n          onClick={() => setActiveModalId('DicomStorePicker')}\r\n        >\r\n          {t('Change DICOM Store')}\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  function handleSort(fieldName) {\r\n    let sortFieldName = fieldName;\r\n    let sortDirection = 'asc';\r\n\r\n    if (fieldName === sort.fieldName) {\r\n      if (sort.direction === 'asc') {\r\n        sortDirection = 'desc';\r\n      } else {\r\n        sortFieldName = null;\r\n        sortDirection = null;\r\n      }\r\n    }\r\n\r\n    setSort({\r\n      fieldName: sortFieldName,\r\n      direction: sortDirection,\r\n    });\r\n  }\r\n\r\n  function handleFilterChange(fieldName, value) {\r\n    setFilterValues(state => {\r\n      return {\r\n        ...state,\r\n        [fieldName]: value,\r\n      };\r\n    });\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {studyListFunctionsEnabled ? (\r\n        <ConnectedDicomFilesUploader\r\n          isOpen={activeModalId === 'DicomFilesUploader'}\r\n          onClose={() => setActiveModalId(null)}\r\n        />\r\n      ) : null}\r\n      {healthCareApiWindows}\r\n      <WhiteLabelingContext.Consumer>\r\n        {whiteLabeling => (\r\n          <UserManagerContext.Consumer>\r\n            {userManager => (\r\n              <ConnectedHeader\r\n                useLargeLogo={true}\r\n                user={user}\r\n                userManager={userManager}\r\n              >\r\n                {whiteLabeling &&\r\n                  whiteLabeling.createLogoComponentFn &&\r\n                  whiteLabeling.createLogoComponentFn(React)}\r\n              </ConnectedHeader>\r\n            )}\r\n          </UserManagerContext.Consumer>\r\n        )}\r\n      </WhiteLabelingContext.Consumer>\r\n      <div className=\"study-list-header\">\r\n        <div className=\"header\">\r\n          <h1 style={{ fontWeight: 300, fontSize: '22px' }}>\r\n            {t('StudyList')}\r\n          </h1>\r\n        </div>\r\n        <div className=\"actions\">\r\n          {studyListFunctionsEnabled && healthCareApiButtons}\r\n          {studyListFunctionsEnabled && (\r\n            <PageToolbar\r\n              onImport={() => setActiveModalId('DicomFilesUploader')}\r\n            />\r\n          )}\r\n          <span className=\"study-count\">{studies.length}</span>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"table-head-background\" />\r\n      <div className=\"study-list-container\">\r\n        {/* STUDY LIST OR DROP ZONE? */}\r\n        <StudyList\r\n          isLoading={searchStatus.isSearchingForStudies}\r\n          hasError={searchStatus.error === true}\r\n          // Rows\r\n          studies={studies}\r\n          onSelectItem={studyInstanceUID => {\r\n            const viewerPath = RoutesUtil.parseViewerPath(appConfig, server, {\r\n              studyInstanceUIDs: studyInstanceUID,\r\n            });\r\n            history.push(viewerPath);\r\n          }}\r\n          // Table Header\r\n          sort={sort}\r\n          onSort={handleSort}\r\n          filterValues={filterValues}\r\n          onFilterChange={handleFilterChange}\r\n          studyListDateFilterNumDays={appConfig.studyListDateFilterNumDays}\r\n          displaySize={displaySize}\r\n        />\r\n        {/* PAGINATION FOOTER */}\r\n        <TablePagination\r\n          currentPage={pageNumber}\r\n          nextPageFunc={() => setPageNumber(pageNumber + 1)}\r\n          prevPageFunc={() => setPageNumber(pageNumber - 1)}\r\n          onRowsPerPageChange={Rows => setRowsPerPage(Rows)}\r\n          rowsPerPage={rowsPerPage}\r\n          recordCount={studies.length}\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nStudyListRoute.propTypes = {\r\n  filters: PropTypes.object,\r\n  PatientID: PropTypes.string,\r\n  server: PropTypes.object,\r\n  user: PropTypes.object,\r\n  history: PropTypes.object,\r\n  studyListFunctionsEnabled: PropTypes.bool,\r\n};\r\n\r\nStudyListRoute.defaultProps = {\r\n  studyListFunctionsEnabled: true,\r\n};\r\n\r\nfunction updateURL(isModalOpen, appConfig, server, history) {\r\n  if (isModalOpen) {\r\n    return;\r\n  }\r\n\r\n  const listPath = RoutesUtil.parseStudyListPath(appConfig, server);\r\n\r\n  if (UrlUtil.paramString.isValidPath(listPath)) {\r\n    const { location = {} } = history;\r\n    if (location.pathname !== listPath) {\r\n      history.replace(listPath);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Not ideal, but we use displaySize to determine how the filters should be used\r\n * to build the collection of promises we need to fetch a result set.\r\n *\r\n * @param {*} server\r\n * @param {*} filters\r\n * @param {object} sort\r\n * @param {string} sort.fieldName - field to sort by\r\n * @param {string} sort.direction - direction to sort\r\n * @param {number} rowsPerPage - Number of results to return\r\n * @param {number} pageNumber - Used to determine results offset\r\n * @param {string} displaySize - small, medium, large\r\n * @returns\r\n */\r\nasync function getStudyList(\r\n  server,\r\n  filters,\r\n  sort,\r\n  rowsPerPage,\r\n  pageNumber,\r\n  displaySize\r\n) {\r\n  const {\r\n    allFields,\r\n    patientNameOrId,\r\n    accessionOrModalityOrDescription,\r\n  } = filters;\r\n  const sortFieldName = sort.fieldName || 'PatientName';\r\n  const sortDirection = sort.direction || 'desc';\r\n  const studyDateFrom =\r\n    filters.studyDateFrom ||\r\n    moment()\r\n      .subtract(25000, 'days')\r\n      .toDate();\r\n  const studyDateTo = filters.studyDateTo || new Date();\r\n\r\n  const mappedFilters = {\r\n    PatientID: filters.PatientID,\r\n    PatientName: filters.PatientName,\r\n    AccessionNumber: filters.AccessionNumber,\r\n    StudyDescription: filters.StudyDescription,\r\n    ModalitiesInStudy: filters.modalities,\r\n    // NEVER CHANGE\r\n    studyDateFrom,\r\n    studyDateTo,\r\n    limit: rowsPerPage,\r\n    offset: pageNumber * rowsPerPage,\r\n    fuzzymatching: server.supportsFuzzyMatching === true,\r\n  };\r\n\r\n  const studies = await _fetchStudies(server, mappedFilters, displaySize, {\r\n    allFields,\r\n    patientNameOrId,\r\n    accessionOrModalityOrDescription,\r\n  });\r\n\r\n  // Only the fields we use\r\n  const mappedStudies = studies.map(study => {\r\n    const PatientName =\r\n      typeof study.PatientName === 'string' ? study.PatientName : undefined;\r\n\r\n    return {\r\n      AccessionNumber: study.AccessionNumber, // \"1\"\r\n      modalities: study.modalities, // \"SEG\\\\MR\"  \r\n      // numberOfStudyRelatedInstances: \"3\"\r\n      // numberOfStudyRelatedSeries: \"3\"\r\n      // PatientBirthdate: undefined\r\n      PatientID: study.PatientID, // \"NOID\"\r\n      PatientName, // \"NAME^NONE\"\r\n      // PatientSex: \"M\"\r\n      // referringPhysicianName: undefined\r\n      StudyDate: study.StudyDate, // \"Jun 28, 2002\"\r\n      StudyDescription: study.StudyDescription, // \"BRAIN\"\r\n      // studyId: \"No Study ID\"\r\n      StudyInstanceUID: study.StudyInstanceUID, // \"1.3.6.1.4.1.5962.99.1.3814087073.479799962.1489872804257.3.0\"\r\n      // StudyTime: \"160956.0\"\r\n    };\r\n  });\r\n\r\n  // For our smaller displays, map our field name to a single\r\n  // field we can actually sort by.\r\n  const sortFieldNameMapping = {\r\n    allFields: 'PatientName',\r\n    patientNameOrId: 'PatientName',\r\n    accessionOrModalityOrDescription: 'modalities',\r\n  };\r\n  const mappedSortFieldName =\r\n    sortFieldNameMapping[sortFieldName] || sortFieldName;\r\n\r\n  const sortedStudies = _sortStudies(\r\n    mappedStudies,\r\n    mappedSortFieldName,\r\n    sortDirection\r\n  );\r\n\r\n  // Because we've merged multiple requests, we may have more than\r\n  // our Rows per page. Let's `take` that number from our sorted array.\r\n  // This \"might\" cause paging issues.\r\n  const numToTake =\r\n    sortedStudies.length < rowsPerPage ? sortedStudies.length : rowsPerPage;\r\n  const result = sortedStudies.slice(0, numToTake);\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n *\r\n *\r\n * @param {object[]} studies - Array of studies to sort\r\n * @param {string} studies.StudyDate - Date in 'MMM DD, YYYY' format\r\n * @param {string} field - name of properties on study to sort by\r\n * @param {string} order - 'asc' or 'desc'\r\n * @returns\r\n */\r\nfunction _sortStudies(studies, field, order) {\r\n  // Make sure our StudyDate is in a valid format and create copy of studies array\r\n  const sortedStudies = studies.map(study => {\r\n    if (!moment(study.StudyDate, 'MMM DD, YYYY', true).isValid()) {\r\n      study.StudyDate = moment(study.StudyDate, 'YYYYMMDD').format(\r\n        'MMM DD, YYYY'\r\n      );\r\n    }\r\n    return study;\r\n  });\r\n\r\n  // Sort by field\r\n  sortedStudies.sort(function(a, b) {\r\n    let fieldA = a[field];\r\n    let fieldB = b[field];\r\n    if (field === 'StudyDate') {\r\n      fieldA = moment(fieldA).toISOString();\r\n      fieldB = moment(fieldB).toISOString();\r\n    }\r\n\r\n    // Order\r\n    if (order === 'desc') {\r\n      if (fieldA < fieldB) {\r\n        return -1;\r\n      }\r\n      if (fieldA > fieldB) {\r\n        return 1;\r\n      }\r\n      return 0;\r\n    } else {\r\n      if (fieldA > fieldB) {\r\n        return -1;\r\n      }\r\n      if (fieldA < fieldB) {\r\n        return 1;\r\n      }\r\n      return 0;\r\n    }\r\n  });\r\n\r\n  return sortedStudies;\r\n}\r\n\r\n/**\r\n * We're forced to do this because DICOMWeb does not support \"AND|OR\" searches\r\n * across multiple fields. This allows us to make multiple requests, remove\r\n * duplicates, and return the result set as if it were supported\r\n *\r\n * @param {object} server\r\n * @param {Object} filters\r\n * @param {string} displaySize - small, medium, or large\r\n * @param {string} multi.allFields\r\n * @param {string} multi.patientNameOrId\r\n * @param {string} multi.accessionOrModalityOrDescription\r\n */\r\nasync function _fetchStudies(\r\n  server,\r\n  filters,\r\n  displaySize,\r\n  { allFields, patientNameOrId, accessionOrModalityOrDescription }\r\n) {\r\n  let queryFiltersArray = [filters];\r\n\r\n  if (displaySize === 'small') {\r\n    const firstSet = _getQueryFiltersForValue(\r\n      filters,\r\n      [\r\n        'PatientID',\r\n        'PatientName',\r\n        'AccessionNumber',\r\n        'StudyDescription',\r\n        'ModalitiesInStudy',\r\n      ],\r\n      allFields\r\n    );\r\n\r\n    if (firstSet.length) {\r\n      queryFiltersArray = firstSet;\r\n    }\r\n  } else if (displaySize === 'medium') {\r\n    const firstSet = _getQueryFiltersForValue(\r\n      filters,\r\n      ['PatientID', 'PatientName'],\r\n      patientNameOrId\r\n    );\r\n\r\n    const secondSet = _getQueryFiltersForValue(\r\n      filters,\r\n      ['AccessionNumber', 'StudyDescription', 'ModalitiesInStudy'],\r\n      accessionOrModalityOrDescription\r\n    );\r\n\r\n    if (firstSet.length || secondSet.length) {\r\n      queryFiltersArray = firstSet.concat(secondSet);\r\n    }\r\n  }\r\n\r\n  const queryPromises = [];\r\n\r\n  queryFiltersArray.forEach(filter => {\r\n    const searchStudiesPromise = OHIF.studies.searchStudies(server, filter);\r\n    queryPromises.push(searchStudiesPromise);\r\n  });\r\n\r\n  const lotsOfStudies = await Promise.all(queryPromises);\r\n  const studies = [];\r\n\r\n  // Flatten and dedupe\r\n  lotsOfStudies.forEach(arrayOfStudies => {\r\n    if (arrayOfStudies) {\r\n      arrayOfStudies.forEach(study => {\r\n        if (!studies.some(s => s.StudyInstanceUID === study.StudyInstanceUID)) {\r\n          studies.push(study);\r\n        }\r\n      });\r\n    }\r\n  });\r\n\r\n  return studies;\r\n}\r\n\r\n/**\r\n *\r\n *\r\n * @param {*} filters\r\n * @param {*} fields - Array of string fields\r\n * @param {*} value\r\n */\r\nfunction _getQueryFiltersForValue(filters, fields, value) {\r\n  const queryFilters = [];\r\n\r\n  if (value === '' || !value) {\r\n    return queryFilters;\r\n  }\r\n\r\n  fields.forEach(field => {\r\n    const filter = Object.assign(\r\n      {\r\n        PatientID: '',\r\n        PatientName: '',\r\n        AccessionNumber: '',\r\n        StudyDescription: '',\r\n        ModalitiesInStudy: '',\r\n      },\r\n      filters\r\n    );\r\n\r\n    filter[field] = value;\r\n    queryFilters.push(filter);\r\n  });\r\n\r\n  return queryFilters;\r\n}\r\n\r\nexport default withRouter(StudyListRoute);\r\n","import { connect } from 'react-redux';\r\n\r\nimport StudyListRoute from './StudyListRoute.js';\r\n\r\nconst isActive = a => a.active === true;\r\n\r\nconst mapStateToProps = state => {\r\n  const activeServer = state.servers.servers.find(isActive);\r\n\r\n  return {\r\n    server: activeServer,\r\n    user: state.oidc.user,\r\n  };\r\n};\r\n\r\nconst ConnectedStudyList = connect(\r\n  mapStateToProps,\r\n  null\r\n)(StudyListRoute);\r\n\r\nexport default ConnectedStudyList;\r\n","import React, { useContext } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { withRouter } from 'react-router-dom';\r\nimport ConnectedStudyList from './ConnectedStudyList';\r\nimport useServer from '../customHooks/useServer';\r\nimport OHIF from '@ohif/core';\r\nconst { urlUtil: UrlUtil } = OHIF.utils;\r\n\r\n// Contexts\r\nimport AppContext from '../context/AppContext';\r\n\r\nfunction StudyListRouting({ match: routeMatch, location: routeLocation }) {\r\n  const {\r\n    project,\r\n    location,\r\n    dataset,\r\n    dicomStore,\r\n    studyInstanceUIDs,\r\n    seriesInstanceUIDs,\r\n  } = routeMatch.params;\r\n  const server = useServer({ project, location, dataset, dicomStore });\r\n  const { appConfig = {} } = useContext(AppContext);\r\n\r\n  const filters = UrlUtil.queryString.getQueryFilters(routeLocation);\r\n\r\n  let studyListFunctionsEnabled = false;\r\n  if (appConfig.studyListFunctionsEnabled) {\r\n    studyListFunctionsEnabled = appConfig.studyListFunctionsEnabled;\r\n  }\r\n  return (\r\n    <ConnectedStudyList\r\n      filters={filters}\r\n      studyListFunctionsEnabled={studyListFunctionsEnabled}\r\n    />\r\n  );\r\n}\r\n\r\nStudyListRouting.propTypes = {\r\n  location: PropTypes.shape({\r\n    search: PropTypes.string,\r\n  }).isRequired,\r\n};\r\n\r\nexport default withRouter(StudyListRouting);\r\n","import React, { useEffect, useRef } from 'react';\r\nexport default function usePrevious(value) {\r\n  const ref = useRef();\r\n  useEffect(() => {\r\n    ref.current = value;\r\n  }, [value]);\r\n\r\n  return ref.current;\r\n}\r\n","class GoogleCloudApi {\r\n  setAccessToken(accessToken) {\r\n    if (!accessToken) console.error('Access token is empty');\r\n    this.accessToken = accessToken;\r\n  }\r\n\r\n  get fetchConfig() {\r\n    if (!this.accessToken) throw new Error('OIDC access_token is not set');\r\n    return {\r\n      method: 'GET',\r\n      headers: {\r\n        Authorization: 'Bearer ' + this.accessToken,\r\n      },\r\n    };\r\n  }\r\n\r\n  get urlBase() {\r\n    return this.healthcareApiEndpoint || 'https://healthcare.googleapis.com/v1beta1';\r\n  }\r\n\r\n  set urlBase(url) {\r\n    this.healthcareApiEndpoint = url;\r\n  }\r\n\r\n  get urlBaseProject() {\r\n    return this.urlBase + `/projects`;\r\n  }\r\n\r\n  getUrlBaseDicomWeb(project, location, dataset, dicomStore) {\r\n    return (\r\n      this.urlBase +\r\n      `/projects/${project}/locations/${location}/datasets/${dataset}/dicomStores/${dicomStore}/dicomWeb`\r\n    );\r\n  }\r\n\r\n  getUrlPath(project, location, dataset, dicomStore) {\r\n    `/projects/${project}/locations/${location}/datasets/${dataset}/dicomStores/${dicomStore}`;\r\n  }\r\n\r\n  async doRequest(urlStr, config = {}, params = {}) {\r\n    const url = new URL(urlStr);\r\n    let data = null;\r\n    url.search = new URLSearchParams(params);\r\n\r\n    try {\r\n      const response = await fetch(url, { ...this.fetchConfig, config });\r\n      try {\r\n        data = await response.json();\r\n      } catch (err) {}\r\n      if (response.status >= 200 && response.status < 300 && data != null) {\r\n        if (data.nextPageToken != null) {\r\n          params.pageToken = data.nextPageToken;\r\n          let subPage = await this.doRequest(urlStr, config, params);\r\n          for (let key in data) {\r\n            if (data.hasOwnProperty(key)) {\r\n              data[key] = data[key].concat(subPage.data[key]);\r\n            }\r\n          }\r\n        }\r\n        return {\r\n          isError: false,\r\n          status: response.status,\r\n          data,\r\n        };\r\n      } else {\r\n        return {\r\n          isError: true,\r\n          status: response.status,\r\n          message:\r\n            (data && data.error && data.error.message) || 'Unknown error',\r\n        };\r\n      }\r\n    } catch (err) {\r\n      if (data && data.error) {\r\n        return {\r\n          isError: true,\r\n          status: err.status,\r\n          message: err.response.data.error.message || 'Unspecified error',\r\n        };\r\n      }\r\n      return {\r\n        isError: true,\r\n        message: (err && err.message) || 'Oops! Something went wrong',\r\n      };\r\n    }\r\n  }\r\n\r\n  async loadProjects() {\r\n    return this.doRequest(\r\n      'https://cloudresourcemanager.googleapis.com/v1/projects'\r\n    );\r\n  }\r\n\r\n  async loadLocations(projectId) {\r\n    return this.doRequest(`${this.urlBaseProject}/${projectId}/locations`);\r\n  }\r\n\r\n  async loadDatasets(projectId, locationId) {\r\n    return this.doRequest(\r\n      `${this.urlBaseProject}/${projectId}/locations/${locationId}/datasets`\r\n    );\r\n  }\r\n\r\n  async loadDicomStores(dataset) {\r\n    return this.doRequest(`${this.urlBase}/${dataset}/dicomStores`);\r\n  }\r\n}\r\n\r\nexport default new GoogleCloudApi();\r\n","const getServers = (data, name) => {\r\n  const {\r\n    wadoUriRoot,\r\n    qidoRoot,\r\n    wadoRoot,\r\n    dataset = '',\r\n    dicomStore = '',\r\n    location = '',\r\n    project = '',\r\n  } = data;\r\n\r\n  return [\r\n    {\r\n      name: name,\r\n      dataset,\r\n      dicomStore,\r\n      location,\r\n      project,\r\n      imageRendering: 'wadors',\r\n      thumbnailRendering: 'wadors',\r\n      type: 'dicomWeb',\r\n      active: true,\r\n      wadoUriRoot,\r\n      qidoRoot,\r\n      wadoRoot,\r\n      supportsFuzzyMatching: false,\r\n      qidoSupportsIncludeField: false,\r\n    },\r\n  ];\r\n};\r\n\r\nconst isValidServer = server => {\r\n  return (\r\n    server &&\r\n    !!server.dataset &&\r\n    !!server.dicomStore &&\r\n    !!server.location &&\r\n    !!server.project\r\n  );\r\n};\r\n\r\nconst isEqualServer = (server = {}, toCompare = {}) => {\r\n  const serverLength = Object.keys(server).length;\r\n  const toCompareLength = Object.keys(toCompare).length;\r\n\r\n  if (!serverLength || !toCompareLength) {\r\n    return false;\r\n  }\r\n\r\n  return (\r\n    server.dataset === toCompare.dataset &&\r\n    server.dataset === toCompare.dataset &&\r\n    server.dicomStore === toCompare.dicomStore &&\r\n    server.location === toCompare.location &&\r\n    server.project === toCompare.project\r\n  );\r\n};\r\n\r\nexport { getServers, isValidServer, isEqualServer };\r\n","import React, { useContext } from 'react';\r\nimport GoogleCloudApi from '../googleCloud/api/GoogleCloudApi';\r\nimport usePrevious from './usePrevious';\r\n\r\nimport * as GoogleCloudUtilServers from '../googleCloud/utils/getServers';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport isEqual from 'lodash.isequal';\r\n\r\n// Contexts\r\nimport AppContext from '../context/AppContext';\r\n\r\nconst getActiveServer = servers => {\r\n  const isActive = a => a.active === true;\r\n\r\n  return servers && servers.servers && servers.servers.find(isActive);\r\n};\r\n\r\nconst getServers = (appConfig, project, location, dataset, dicomStore) => {\r\n  let servers = [];\r\n  if (appConfig.enableGoogleCloudAdapter) {\r\n    GoogleCloudApi.urlBase = appConfig.healthcareApiEndpoint;\r\n    const pathUrl = GoogleCloudApi.getUrlBaseDicomWeb(\r\n      project,\r\n      location,\r\n      dataset,\r\n      dicomStore\r\n    );\r\n    const data = {\r\n      project,\r\n      location,\r\n      dataset,\r\n      dicomStore,\r\n      wadoUriRoot: pathUrl,\r\n      qidoRoot: pathUrl,\r\n      wadoRoot: pathUrl,\r\n    };\r\n    servers = GoogleCloudUtilServers.getServers(data, dicomStore);\r\n    if (!isValidServer(servers[0], appConfig)) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  return servers;\r\n};\r\n\r\nconst isValidServer = (server, appConfig) => {\r\n  if (appConfig.enableGoogleCloudAdapter) {\r\n    return GoogleCloudUtilServers.isValidServer(server);\r\n  }\r\n\r\n  return !!server;\r\n};\r\n\r\nconst setServers = (dispatch, servers) => {\r\n  const action = {\r\n    type: 'SET_SERVERS',\r\n    servers,\r\n  };\r\n  dispatch(action);\r\n};\r\n\r\nconst useServerFromUrl = (\r\n  servers = [],\r\n  previousServers,\r\n  activeServer,\r\n  urlBasedServers,\r\n  appConfig,\r\n  project,\r\n  location,\r\n  dataset,\r\n  dicomStore\r\n) => {\r\n  // update state from url available only when gcloud on\r\n  if (!appConfig.enableGoogleCloudAdapter) {\r\n    return false;\r\n  }\r\n\r\n  const serverHasChanged = previousServers !== servers && previousServers;\r\n\r\n  // do not update from url. use state instead.\r\n  if (serverHasChanged) {\r\n    return false;\r\n  }\r\n\r\n  // if no valid urlbased servers\r\n  if (!urlBasedServers || !urlBasedServers.length) {\r\n    return false;\r\n  } else if (!servers.length || !activeServer) {\r\n    // no current valid server\r\n    return true;\r\n  }\r\n\r\n  const newServer = urlBasedServers[0];\r\n\r\n  let exists = servers.some(\r\n    GoogleCloudUtilServers.isEqualServer.bind(undefined, newServer)\r\n  );\r\n\r\n  return !exists;\r\n};\r\n\r\nexport default function useServer({\r\n  project,\r\n  location,\r\n  dataset,\r\n  dicomStore,\r\n} = {}) {\r\n  // Hooks\r\n  const servers = useSelector(state => state && state.servers);\r\n  const previousServers = usePrevious(servers);\r\n  const dispatch = useDispatch();\r\n\r\n  const { appConfig = {} } = useContext(AppContext);\r\n\r\n  const activeServer = getActiveServer(servers);\r\n  const urlBasedServers =\r\n    getServers(appConfig, project, location, dataset, dicomStore) || [];\r\n  const shouldUpdateServer = useServerFromUrl(\r\n    servers.servers,\r\n    previousServers,\r\n    activeServer,\r\n    urlBasedServers,\r\n    appConfig,\r\n    project,\r\n    location,\r\n    dataset,\r\n    dicomStore\r\n  );\r\n\r\n  if (shouldUpdateServer) {\r\n    setServers(dispatch, urlBasedServers);\r\n  } else if (isValidServer(activeServer, appConfig)) {\r\n    return activeServer;\r\n  }\r\n}\r\n","export default class FileLoader {\r\n  fileType;\r\n  loadFile(file, imageId) { }\r\n  getDataset(image, imageId) { }\r\n  getStudies(dataset, imageId) { }\r\n}\r\n","import cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';\r\nimport FileLoader from './fileLoader';\r\n\r\nconst PDFFileLoader = new (class extends FileLoader {\r\n  fileType = 'application/pdf';\r\n  loadFile(file, imageId) {\r\n    return cornerstoneWADOImageLoader.wadouri.loadFileRequest(imageId);\r\n  }\r\n\r\n  getDataset(image, imageId) {\r\n    const dataset = {};\r\n    dataset.imageId = image.imageId || imageId;\r\n    return dataset;\r\n  }\r\n\r\n  getStudies(dataset, imageId) {\r\n    return this.getDefaultStudy(imageId);\r\n  }\r\n\r\n  getDefaultStudy(imageId) {\r\n    const study = {\r\n      StudyInstanceUID: '',\r\n      StudyDate: '',\r\n      StudyTime: '',\r\n      AccessionNumber: '',\r\n      ReferringPhysicianName: '',\r\n      PatientName: '',\r\n      PatientID: '',\r\n      PatientBirthdate: '',\r\n      PatientSex: '',\r\n      StudyId: '',\r\n      StudyDescription: '',\r\n      series: [\r\n        {\r\n          SeriesInstanceUID: '',\r\n          SeriesDescription: '',\r\n          SeriesNumber: '',\r\n          instances: [\r\n            {\r\n              metadata: {\r\n                SOPInstanceUID: '',\r\n                SOPClassUID: '1.2.840.10008.5.1.4.1.1.104.1',\r\n                Rows: '',\r\n                Columns: '',\r\n                NumberOfFrames: 0,\r\n                InstanceNumber: 1,\r\n              },\r\n              getImageId: () => imageId,\r\n              isLocalFile: true,\r\n            },\r\n          ],\r\n        },\r\n      ],\r\n    };\r\n\r\n    return study;\r\n  }\r\n})();\r\n\r\nexport default PDFFileLoader;\r\n","import dcmjs from 'dcmjs';\r\nimport cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';\r\nimport FileLoader from './fileLoader';\r\nimport OHIF from '@ohif/core';\r\n\r\nconst metadataProvider = OHIF.cornerstone.metadataProvider;\r\n\r\nconst DICOMFileLoader = new (class extends FileLoader {\r\n  fileType = 'application/dicom';\r\n  loadFile(file, imageId) {\r\n    return cornerstoneWADOImageLoader.wadouri.loadFileRequest(imageId);\r\n  }\r\n\r\n  getDataset(image, imageId) {\r\n    let dataset = {};\r\n    try {\r\n      const dicomData = dcmjs.data.DicomMessage.readFile(image);\r\n\r\n      dataset = dcmjs.data.DicomMetaDictionary.naturalizeDataset(\r\n        dicomData.dict\r\n      );\r\n\r\n      metadataProvider.addInstance(dataset);\r\n\r\n      dataset._meta = dcmjs.data.DicomMetaDictionary.namifyDataset(\r\n        dicomData.meta\r\n      );\r\n    } catch (e) {\r\n      console.error('Error reading dicom file', e);\r\n    }\r\n    // Set imageId on dataset to be consumed later on\r\n    dataset.imageId = imageId;\r\n\r\n    return dataset;\r\n  }\r\n\r\n  getStudies(dataset, imageId) {\r\n    return this.getStudyFromDataset(dataset);\r\n  }\r\n\r\n  getStudyFromDataset(dataset = {}) {\r\n    const {\r\n      StudyInstanceUID,\r\n      StudyDate,\r\n      StudyTime,\r\n      AccessionNumber,\r\n      ReferringPhysicianName,\r\n      PatientName,\r\n      PatientID,\r\n      PatientBirthDate,\r\n      PatientSex,\r\n      StudyID,\r\n      StudyDescription,\r\n      SeriesInstanceUID,\r\n      SeriesDescription,\r\n      SeriesNumber,\r\n      imageId,\r\n    } = dataset;\r\n\r\n    const instance = {\r\n      metadata: dataset,\r\n      url: imageId,\r\n    };\r\n\r\n    const series = {\r\n      SeriesInstanceUID: SeriesInstanceUID,\r\n      SeriesDescription: SeriesDescription,\r\n      SeriesNumber: SeriesNumber,\r\n      instances: [instance],\r\n    };\r\n\r\n    const study = {\r\n      StudyInstanceUID,\r\n      StudyDate,\r\n      StudyTime,\r\n      AccessionNumber,\r\n      ReferringPhysicianName,\r\n      PatientName,\r\n      PatientID,\r\n      PatientBirthDate,\r\n      PatientSex,\r\n      StudyID,\r\n      StudyDescription,\r\n      /*\r\n      TODO: in case necessary to uncomment this block, double check every property\r\n      numberOfStudyRelatedSeries: NumberOfStudyRelatedSeries || DICOMWeb.getString(dataset['00201206']),\r\n      numberOfStudyRelatedInstances: NumberOfStudyRelatedInstances || DICOMWeb.getString(dataset['00201208']),\r\n      Modality: Modality || DICOMWeb.getString(dataset['00080060']),\r\n      ModalitiesInStudy: ModalitiesInStudy || DICOMWeb.getString(dataset['00080061']),\r\n      modalities:\r\n      */\r\n      series: [series],\r\n    };\r\n\r\n    return study;\r\n  }\r\n})();\r\n\r\nexport default DICOMFileLoader;\r\n","import cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';\r\nimport FileLoader from './fileLoader';\r\nimport PDFFileLoader from './pdfFileLoader';\r\nimport DICOMFileLoader from './dicomFileLoader';\r\n\r\nclass FileLoaderService extends FileLoader {\r\n  fileType;\r\n  loader;\r\n  constructor(file) {\r\n    super();\r\n    const fileType = file && file.type;\r\n    this.loader = this.getLoader(fileType);\r\n    this.fileType = this.loader.fileType;\r\n  }\r\n\r\n  static groupSeries(studies) {\r\n    const groupBy = (list, groupByKey, listKey) => {\r\n      let nonKeyCounter = 1;\r\n\r\n      return list.reduce((acc, obj) => {\r\n        let key = obj[groupByKey];\r\n        const list = obj[listKey];\r\n\r\n        // in case key not found, group it using counter\r\n        key = !!key ? key : '' + nonKeyCounter++;\r\n\r\n        if (!acc[key]) {\r\n          acc[key] = { ...obj };\r\n          acc[key][listKey] = [];\r\n        }\r\n\r\n        acc[key][listKey].push(...list);\r\n\r\n        return acc;\r\n      }, {});\r\n    };\r\n\r\n    const studiesGrouped = Object.values(\r\n      groupBy(studies, 'StudyInstanceUID', 'series')\r\n    );\r\n\r\n    const result = studiesGrouped.map(studyGroup => {\r\n      const seriesGrouped = groupBy(\r\n        studyGroup.series,\r\n        'SeriesInstanceUID',\r\n        'instances'\r\n      );\r\n      studyGroup.series = Object.values(seriesGrouped);\r\n\r\n      return studyGroup;\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  addFile(file) {\r\n    return cornerstoneWADOImageLoader.wadouri.fileManager.add(file);\r\n  }\r\n\r\n  loadFile(file, imageId) {\r\n    return this.loader.loadFile(file, imageId);\r\n  }\r\n\r\n  getDataset(image, imageId) {\r\n    return this.loader.getDataset(image, imageId);\r\n  }\r\n\r\n  getStudies(dataset, imageId) {\r\n    return this.loader.getStudies(dataset, imageId);\r\n  }\r\n\r\n  getLoader(fileType) {\r\n    if (fileType === 'application/pdf') {\r\n      return PDFFileLoader;\r\n    } else {\r\n      // Default to dicom loader\r\n      return DICOMFileLoader;\r\n    }\r\n  }\r\n}\r\n\r\nexport default FileLoaderService;\r\n","import FileLoaderService from './localFileLoaders/fileLoaderService';\r\n\r\nconst processFile = async file => {\r\n  try {\r\n    const fileLoaderService = new FileLoaderService(file);\r\n    const imageId = fileLoaderService.addFile(file);\r\n    const image = await fileLoaderService.loadFile(file, imageId);\r\n    const dataset = await fileLoaderService.getDataset(image, imageId);\r\n    const studies = await fileLoaderService.getStudies(dataset, imageId);\r\n\r\n    return studies;\r\n  } catch (error) {\r\n    console.log(\r\n      error.name,\r\n      ':Error when trying to load and process local files:',\r\n      error.message\r\n    );\r\n  }\r\n};\r\n\r\nexport default async function filesToStudies(files) {\r\n  const processFilesPromises = files.map(processFile);\r\n  const studies = await Promise.all(processFilesPromises);\r\n\r\n  return FileLoaderService.groupSeries(studies.flat());\r\n}\r\n"],"sourceRoot":""}