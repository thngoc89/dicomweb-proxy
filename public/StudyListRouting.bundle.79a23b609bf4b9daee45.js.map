{"version":3,"sources":["webpack:///./googleCloud/utils/helpers.js","webpack:///./googleCloud/utils/CancellationToken.js","webpack:///./googleCloud/api/DicomUploadService.js","webpack:///./googleCloud/DicomUploader.js","webpack:///./googleCloud/DicomFileUploaderModal.js","webpack:///./googleCloud/ConnectedDicomFilesUploader.js","webpack:///./googleCloud/DicomStoreList.js","webpack:///./googleCloud/DicomStorePicker.js","webpack:///./googleCloud/DatasetsList.js","webpack:///./googleCloud/DatasetPicker.js","webpack:///./googleCloud/ProjectsList.js","webpack:///./googleCloud/ProjectPicker.js","webpack:///./googleCloud/LocationsList.js","webpack:///./googleCloud/LocationPicker.js","webpack:///./googleCloud/DatasetSelector.js","webpack:///./googleCloud/DicomStorePickerModal.js","webpack:///./googleCloud/ConnectedDicomStorePicker.js","webpack:///./studylist/StudyListRoute.js","webpack:///./studylist/ConnectedStudyList.js","webpack:///./studylist/StudyListRouting.js","webpack:///./customHooks/usePrevious.js","webpack:///./googleCloud/api/GoogleCloudApi.js","webpack:///./googleCloud/utils/getServers.js","webpack:///./customHooks/useServer.js","webpack:///./lib/localFileLoaders/fileLoader.js","webpack:///./lib/localFileLoaders/pdfFileLoader.js","webpack:///./lib/localFileLoaders/dicomFileLoader.js","webpack:///./lib/localFileLoaders/fileLoaderService.js","webpack:///./lib/filesToStudies.js"],"names":["formatFileSize","size","n","Math","floor","log","pow","toFixed","httpErrorToStr","error","response","jsonResponse","JSON","parse","code","message","err","checkDicomFile","arrayBuffer","length","arr","Uint8Array","slice","Array","from","every","char","i","charCodeAt","CancellationToken","this","cancelled","value","files","url","uploadCallback","cancellationToken","CHUNK_SIZE","MAX_PARALLEL_JOBS","filesArray","Error","parallelJobsCount","min","completed","processJob","resolve","reject","get","chunk","simpleUpload","forEach","file","fileId","Promise","client","getClient","readFile","loadedFile","content","storeInstances","datasets","reader","FileReader","onload","name","type","result","onerror","readAsArrayBuffer","func","retrieveAuthHeaderFunc","headers","api","DICOMwebClient","DicomUploader","status","isCancelled","errorsCount","uploadedVolume","wholeVolumeStr","isFilesListHidden","timeLeft","uploadedList","totalCount","successfullyUploadedCount","lastFile","uploadContext","target","filesDict","fileDesc","id","path","webkitRelativePath","processed","processedInUI","wholeVolume","map","f","reduce","a","b","random","setState","dicomUploader","setRetrieveAuthHeaderFunction","props","retrieveAuthHeaderFunction","smartUpload","state","call","style","color","key","className","parseInt","Object","keys","errors","push","htmlFor","src","alt","onChange","uploadFiles","multiple","webkitdirectory","mozdirectory","percents","filesLeft","renderTableRow","Component","PropTypes","string","event","DicomFileUploaderModal","uploaded","show","isOpen","onHide","onClose","aria-labelledby","backdrop","keyboard","Header","closeButton","Title","t","Body","withTranslation","isActive","active","ConnectedDicomFileUploader","connect","activeServer","servers","find","OHIF","DICOMWeb","getAuthorizationHeader","qidoRoot","DicomStoreList","search","store","highlightedItem","onMouseEnter","onHighlightItem","onClick","onSelect","split","loading","stores","filter","loadingIcon","body","toLowerCase","includes","array","bool","isRequired","DicomStorePicker","locations","filterStr","setAccessToken","accessToken","loadDicomStores","dataset","isError","data","dicomStores","e","object","DatasetsList","DatasetPicker","loadDatasets","project","projectId","location","locationId","ProjectsList","projects","lowerCaseFilter","filteredProjects","ProjectPicker","loadProjects","LocationsList","LocationPicker","loadLocations","DatasetSelector","unloading","dicomStoreJson","dicomStore","parts","wadoUriRoot","GoogleCloudApi","urlBase","wadoRoot","setServers","user","access_token","onProjectClick","onLocationClick","onDatasetClick","onProjectSelect","onLocationSelect","onDatasetSelect","onDicomStoreSelect","projectBreadcrumbs","canClose","DicomStorePickerModal","UIModalService","servicesManager","services","Fragment","title","contentProps","GoogleCloudUtilServers","dicomstore","hide","propTypes","ConnectedDicomStorePicker","oidc","dispatch","UrlUtil","utils","urlUtil","StudyListRoute","history","server","studyListFunctionsEnabled","useTranslation","useState","fieldName","direction","sort","setSort","studyDateTo","studyDateFrom","PatientName","PatientID","AccessionNumber","StudyDate","modalities","StudyDescription","patientNameOrId","accessionOrModalityOrDescription","allFields","filterValues","setFilterValues","studies","setStudies","isSearchingForStudies","searchStatus","setSearchStatus","activeModalId","setActiveModalId","rowsPerPage","setRowsPerPage","pageNumber","setPageNumber","appContext","useContext","AppContext","displaySize","useMedia","debouncedSort","useDebounce","debouncedFilters","appConfig","enableGoogleCloudAdapter","useEffect","getStudyList","console","warn","isFetching","fetchStudies","stringify","healthCareApiButtons","healthCareApiWindows","isModalOpen","listPath","RoutesUtil","paramString","isValidPath","pathname","replace","updateURL","padding","ConnectedDicomFilesUploader","WhiteLabellingContext","Consumer","whiteLabelling","UserManagerContext","userManager","ConnectedHeader","home","logoComponent","fontWeight","fontSize","onImport","isLoading","hasError","onSelectItem","studyInstanceUID","viewerPath","studyInstanceUIDs","onSort","sortFieldName","sortDirection","onFilterChange","studyListDateFilterNumDays","currentPage","nextPageFunc","prevPageFunc","onRowsPerPageChange","Rows","recordCount","filters","moment","subtract","toDate","Date","mappedFilters","ModalitiesInStudy","limit","offset","fuzzymatching","supportsFuzzyMatching","_fetchStudies","mappedStudies","study","undefined","StudyInstanceUID","sortedStudies","_sortStudies","numToTake","field","order","isValid","format","fieldA","fieldB","toISOString","queryFiltersArray","firstSet","_getQueryFiltersForValue","secondSet","concat","queryPromises","searchStudiesPromise","searchStudies","all","lotsOfStudies","arrayOfStudies","some","s","fields","queryFilters","assign","defaultProps","withRouter","ConnectedStudyList","StudyListRouting","routeMatch","match","routeLocation","params","seriesInstanceUIDs","useServer","queryString","getQueryFilters","shape","usePrevious","ref","useRef","current","urlStr","config","URL","URLSearchParams","fetch","fetchConfig","json","nextPageToken","pageToken","doRequest","subPage","hasOwnProperty","urlBaseProject","method","Authorization","healthcareApiEndpoint","getServers","imageRendering","thumbnailRendering","qidoSupportsIncludeField","isValidServer","isEqualServer","toCompare","serverLength","toCompareLength","getActiveServer","pathUrl","getUrlBaseDicomWeb","useServerFromUrl","previousServers","urlBasedServers","serverHasChanged","newServer","exists","bind","useSelector","useDispatch","shouldUpdateServer","FileLoader","imageId","image","PDFFileLoader","getCornerstoneWADOImageLoader","cornerstoneWADOImageLoader","wadouri","loadFileRequest","getDefaultStudy","StudyTime","ReferringPhysicianName","PatientBirthdate","PatientSex","StudyId","series","SeriesInstanceUID","SeriesDescription","SeriesNumber","instances","metadata","SOPInstanceUID","SOPClassUID","Columns","NumberOfFrames","InstanceNumber","getImageId","isLocalFile","metadataProvider","cornerstone","DICOMFileLoader","dicomData","dcmjs","DicomMessage","DicomMetaDictionary","naturalizeDataset","dict","addInstance","_meta","namifyDataset","meta","getStudyFromDataset","PatientBirthDate","StudyID","instance","FileLoaderService","fileType","loader","getLoader","fileManager","add","loadFile","getDataset","getStudies","groupBy","list","groupByKey","listKey","nonKeyCounter","acc","obj","values","studyGroup","seriesGrouped","processFile","fileLoaderService","addFile","filesToStudies","processFilesPromises","groupSeries","flat"],"mappings":"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","file":"StudyListRouting.bundle.79a23b609bf4b9daee45.js","sourcesContent":["export function formatFileSize(size) {\r\n  if (size === 0) return '0 B';\r\n  const n = Math.floor(Math.log(size) / Math.log(1024));\r\n  return (\r\n    (size / Math.pow(1024, n)).toFixed(2) * 1 +\r\n    ' ' +\r\n    ['B', 'kB', 'MB', 'GB', 'TB'][n]\r\n  );\r\n}\r\n\r\nexport function httpErrorToStr(error) {\r\n  if (!error) return 'Unknown error';\r\n  if (error.response) {\r\n    try {\r\n      const jsonResponse = JSON.parse(error.response);\r\n      if (\r\n        jsonResponse.error &&\r\n        jsonResponse.error.code &&\r\n        jsonResponse.error.message\r\n      )\r\n        return jsonResponse.error.code + ' - ' + jsonResponse.error.message;\r\n    } catch (err) {\r\n      return error.response;\r\n    }\r\n  }\r\n  return error.message || 'Unknown error.';\r\n}\r\n\r\n/* eslint-disable */\r\nexport function checkDicomFile(arrayBuffer) {\r\n  if (arrayBuffer.length <= 132) return false;\r\n  const arr = new Uint8Array(arrayBuffer.slice(128, 132));\r\n  // bytes from 128 to 132 must be \"DICM\"\r\n  return Array.from('DICM').every((char, i) => char.charCodeAt(0) === arr[i]);\r\n}\r\n","export default class CancellationToken {\r\n  constructor() {\r\n    this.cancelled = false;\r\n  }\r\n\r\n  get() {\r\n    return this.cancelled;\r\n  }\r\n\r\n  set(value) {\r\n    this.cancelled = value;\r\n  }\r\n}\r\n","import { httpErrorToStr, checkDicomFile } from '../utils/helpers';\r\nimport { api } from 'dicomweb-client';\r\n\r\nclass DicomUploadService {\r\n  async smartUpload(files, url, uploadCallback, cancellationToken) {\r\n    const CHUNK_SIZE = 1; // Only one file per request is supported so far\r\n    const MAX_PARALLEL_JOBS = 50; // FIXME: tune MAX_PARALLEL_JOBS number\r\n\r\n    let filesArray = Array.from(files);\r\n    if (filesArray.length === 0) {\r\n      throw new Error('No files were provided.');\r\n    }\r\n\r\n    let parallelJobsCount = Math.min(filesArray.length, MAX_PARALLEL_JOBS);\r\n    let completed = false;\r\n\r\n    const processJob = async (resolve, reject) => {\r\n      while (filesArray.length > 0) {\r\n        if (cancellationToken.get()) return;\r\n        let chunk = filesArray.slice(0, CHUNK_SIZE);\r\n        filesArray = filesArray.slice(CHUNK_SIZE);\r\n        let error = null;\r\n        try {\r\n          if (chunk.length > 1) throw new Error('Not implemented');\r\n          if (chunk.length === 1)\r\n            await this.simpleUpload(chunk[0], url);\r\n        } catch (err) {\r\n          // It looks like a stupid bug of Babel that err is not an actual Exception object\r\n          error = httpErrorToStr(err);\r\n        }\r\n        chunk.forEach(file => uploadCallback(file.fileId, error));\r\n        if (!completed && filesArray.length === 0) {\r\n          completed = true;\r\n          resolve();\r\n          return;\r\n        }\r\n      }\r\n    };\r\n\r\n    await new Promise(resolve => {\r\n      for (let i = 0; i < parallelJobsCount; i++) {\r\n        processJob(resolve);\r\n      }\r\n    });\r\n  }\r\n\r\n  async simpleUpload(file, url) {\r\n    const client = this.getClient(url);\r\n    const loadedFile = await this.readFile(file);\r\n    const content = loadedFile.content;\r\n    if (!checkDicomFile(content))\r\n      throw new Error('This is not a valid DICOM file.');\r\n\r\n    await client.storeInstances({ datasets: [content] });\r\n  }\r\n\r\n  readFile(file) {\r\n    return new Promise((resolve, reject) => {\r\n      const reader = new FileReader();\r\n      reader.onload = () => {\r\n        resolve({\r\n          name: file.name,\r\n          size: file.size,\r\n          type: file.type,\r\n          content: reader.result,\r\n        });\r\n      };\r\n      reader.onerror = error => reject(error);\r\n      reader.readAsArrayBuffer(file);\r\n    });\r\n  }\r\n\r\n  setRetrieveAuthHeaderFunction(func) {\r\n    this.retrieveAuthHeaderFunc = func;\r\n  }\r\n\r\n  getClient(url) {\r\n    const headers = this.retrieveAuthHeaderFunc();\r\n\r\n    // TODO: a bit weird we are creating a new dicomweb client instance for every upload\r\n    return new api.DICOMwebClient({\r\n      url,\r\n      headers\r\n    });\r\n  }\r\n}\r\n\r\nexport default new DicomUploadService();\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { formatFileSize } from './utils/helpers';\r\nimport CancellationToken from './utils/CancellationToken';\r\nimport dicomUploader from './api/DicomUploadService';\r\nimport './DicomUploader.css';\r\n\r\nexport default class DicomUploader extends Component {\r\n  state = {\r\n    status: 'Upload',\r\n    isCancelled: false,\r\n    errorsCount: 0,\r\n    files: null,\r\n    uploadedVolume: null,\r\n    wholeVolumeStr: null,\r\n    isFilesListHidden: true,\r\n    timeLeft: null,\r\n    uploadedList: null,\r\n    totalCount: 0,\r\n    successfullyUploadedCount: 0,\r\n    lastFile: '',\r\n    uploadContext: null, // this is probably not needed, but we use this variable to distinguish between different downloads\r\n  };\r\n\r\n  static propTypes = {\r\n    id: PropTypes.string,\r\n    event: PropTypes.string,\r\n    url: PropTypes.string,\r\n    retrieveAuthHeaderFunction: PropTypes.func,\r\n  };\r\n\r\n  filesLeft() {\r\n    return (\r\n      this.state.uploadedList.length + ' of ' + this.state.totalCount + ' files'\r\n    );\r\n  }\r\n\r\n  volumeLeft() {\r\n    let left = formatFileSize(this.state.uploadedVolume);\r\n    return left + ' of ' + this.state.wholeVolumeStr;\r\n  }\r\n\r\n  percents() {\r\n    return parseInt(\r\n      (100 * this.state.uploadedList.length) /\r\n        Object.keys(this.state.files).length\r\n    );\r\n  }\r\n\r\n  isFinished() {\r\n    return (\r\n      this.state.isCancelled ||\r\n      Object.keys(this.state.files).length === this.state.uploadedList.length\r\n    );\r\n  }\r\n\r\n  errorsMessage() {\r\n    const errors = this.state.errorsCount === 1 ? ' error' : ' errors';\r\n    return (\r\n      this.state.errorsCount + errors + ' while uploading, click for more info'\r\n    );\r\n  }\r\n\r\n  uploadFiles = files => {\r\n    const filesArray = Array.from(files.target.files);\r\n    const filesDict = {};\r\n    filesArray.forEach((file, i) => {\r\n      const fileDesc = {\r\n        id: i,\r\n        name: file.name,\r\n        path: file.webkitRelativePath || file.name,\r\n        size: file.size,\r\n        error: null,\r\n        processed: false,\r\n        processedInUI: false,\r\n      };\r\n      filesDict[i] = fileDesc;\r\n      file.fileId = i;\r\n    });\r\n    const wholeVolume = filesArray.map(f => f.size).reduce((a, b) => a + b);\r\n    const uploadContext = Math.random();\r\n    this.setState({\r\n      status: 'Uploading...',\r\n      files: filesDict,\r\n      uploadedList: [],\r\n      uploadedVolume: 0,\r\n      lastFile: filesArray[0].name,\r\n      totalCount: filesArray.length,\r\n      wholeVolumeStr: formatFileSize(wholeVolume),\r\n      uploadContext: uploadContext,\r\n      cancellationToken: new CancellationToken(),\r\n    });\r\n    const cancellationToken = new CancellationToken();\r\n    const uploadCallback = (fileId, error) =>\r\n      uploadContext === this.state.uploadContext &&\r\n      this.uploadCallback.call(this, fileId, error);\r\n\r\n    dicomUploader.setRetrieveAuthHeaderFunction(this.props.retrieveAuthHeaderFunction);\r\n\r\n    dicomUploader.smartUpload(\r\n      files.target.files,\r\n      this.props.url,\r\n      uploadCallback,\r\n      cancellationToken\r\n    );\r\n  };\r\n\r\n  uploadCallback(fileId, error) {\r\n    const file = this.state.files[fileId];\r\n    file.processed = true;\r\n    if (!error) {\r\n      let uploadedVolume = this.state.uploadedVolume + file.size;\r\n      this.setState({ uploadedVolume });\r\n    } else {\r\n      file.error = error;\r\n      this.setState({ errorsCount: this.state.errorsCount + 1 });\r\n    }\r\n    this.setState({ lastFile: file.name });\r\n    let uploadedList = this.state.uploadedList;\r\n    uploadedList.push(file);\r\n    this.setState({ uploadedList });\r\n  }\r\n\r\n  renderTableRow = file => {\r\n    let error = null;\r\n    if (file.error !== null) {\r\n      error = <p style={{ color: 'red' }}>{file.error}</p>;\r\n    }\r\n    return (\r\n      <tr key={file.id}>\r\n        <td className=\"project\">\r\n          {file.name} {error}\r\n        </td>\r\n      </tr>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    if (this.state.files === null) {\r\n      return (\r\n        <div className=\"dicom-uploader\">\r\n          <div className=\"button\">\r\n            <label htmlFor=\"file\">\r\n              <img src=\"./assets/Button_File.svg\" alt=\"upload file\"></img>\r\n            </label>\r\n            <input\r\n              className=\"invisible-input\"\r\n              onChange={this.uploadFiles}\r\n              type=\"file\"\r\n              id=\"file\"\r\n              multiple\r\n            />\r\n          </div>\r\n\r\n          <div className=\"button\">\r\n            <label htmlFor=\"folder\">\r\n              <img src=\"./assets/Button_Folder.svg\" alt=\"upload folder\"></img>\r\n            </label>\r\n            <input\r\n              className=\"invisible-input\"\r\n              type=\"file\"\r\n              onChange={this.uploadFiles}\r\n              id=\"folder\"\r\n              webkitdirectory=\"true\"\r\n              mozdirectory=\"true\"\r\n              multiple\r\n            />\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <table id=\"tblProjectList\" className=\"table noselect\">\r\n        <thead>\r\n          <tr>\r\n            <th className=\"table-header\">\r\n              {this.percents()}% {this.filesLeft()}\r\n            </th>\r\n          </tr>\r\n        </thead>\r\n        <tbody id=\"ProjectList\">\r\n          {this.state.uploadedList.map(this.renderTableRow)}\r\n        </tbody>\r\n      </table>\r\n    );\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Modal from 'react-bootstrap-modal';\r\nimport DicomUploader from './DicomUploader';\r\nimport { withTranslation } from 'react-i18next';\r\n\r\nclass DicomFileUploaderModal extends Component {\r\n  static propTypes = {\r\n    url: PropTypes.string,\r\n    retrieveAuthHeaderFunction: PropTypes.func,\r\n    onClose: PropTypes.func,\r\n  };\r\n\r\n  state = {\r\n    uploaded: false,\r\n  };\r\n\r\n  render() {\r\n    if (!this.props.url) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <Modal\r\n        show={this.props.isOpen}\r\n        onHide={this.props.onClose}\r\n        aria-labelledby=\"ModalHeader\"\r\n        className=\"modal fade themed in\"\r\n        backdrop={false}\r\n        size={'md'}\r\n        keyboard={true}\r\n      >\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>\r\n            {this.props.t('Upload DICOM Files')}\r\n          </Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <DicomUploader\r\n            url={this.props.url}\r\n            retrieveAuthHeaderFunction={this.props.retrieveAuthHeaderFunction}\r\n          />\r\n        </Modal.Body>\r\n      </Modal>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withTranslation('Common')(DicomFileUploaderModal);\r\n","import { connect } from 'react-redux';\r\nimport DicomFileUploaderModal from './DicomFileUploaderModal.js';\r\nimport OHIF from '@ohif/core';\r\n\r\nconst isActive = a => a.active === true;\r\n\r\nconst mapStateToProps = state => {\r\n  const activeServer = state.servers.servers.find(isActive);\r\n\r\n  // TODO: Not sure I like this approach since it means we are recreating\r\n  // this function every time redux changes\r\n  const retrieveAuthHeaderFunction = () =>\r\n    OHIF.DICOMWeb.getAuthorizationHeader(activeServer);\r\n\r\n  return {\r\n    retrieveAuthHeaderFunction,\r\n    url: activeServer && activeServer.qidoRoot,\r\n  };\r\n};\r\n\r\nconst ConnectedDicomFileUploader = connect(\r\n  mapStateToProps,\r\n  null\r\n)(DicomFileUploaderModal);\r\n\r\nexport default ConnectedDicomFileUploader;\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport './googleCloud.css';\r\nimport { withTranslation } from 'react-i18next';\r\nimport { Icon } from '@ohif/ui';\r\n\r\nclass DicomStoreList extends Component {\r\n  state = {\r\n    search: '',\r\n  };\r\n\r\n  static propTypes = {\r\n    stores: PropTypes.array,\r\n    loading: PropTypes.bool.isRequired,\r\n    error: PropTypes.string,\r\n    onSelect: PropTypes.func,\r\n  };\r\n\r\n  static defaultProps = {\r\n    loading: true,\r\n  };\r\n\r\n  renderTableRow = store => {\r\n    return (\r\n      <tr\r\n        key={store.name}\r\n        className={\r\n          this.state.highlightedItem === store.name\r\n            ? 'noselect active'\r\n            : 'noselect'\r\n        }\r\n        onMouseEnter={() => {\r\n          this.onHighlightItem(store.name);\r\n        }}\r\n        onClick={() => {\r\n          this.props.onSelect(store);\r\n        }}\r\n      >\r\n        <td className=\"project\">{store.name.split('/')[7]}</td>\r\n      </tr>\r\n    );\r\n  };\r\n\r\n  onHighlightItem(store) {\r\n    this.setState({ highlightedItem: store });\r\n  }\r\n\r\n  render() {\r\n    const { loading, stores, filter, error } = this.props;\r\n\r\n    if (error) {\r\n      return <p>{error}</p>;\r\n    }\r\n\r\n    const loadingIcon = (\r\n      <Icon name=\"circle-notch\" className=\"loading-icon-spin loading-icon\" />\r\n    );\r\n\r\n    if (loading) {\r\n      return loadingIcon;\r\n    }\r\n\r\n    const body = (\r\n      <tbody id=\"StoreList\">{\r\n        stores.filter(store => (store.name.split('/')[7].toLowerCase().includes(filter.toLowerCase()) || filter==\"\")).map(this.renderTableRow)}\r\n      </tbody>\r\n    );\r\n\r\n    return (\r\n      <table id=\"tblStoreList\" className=\"gcp-table table noselect\">\r\n        <thead>\r\n          <tr>\r\n            <th>{this.props.t('DICOM Store')}</th>\r\n          </tr>\r\n        </thead>\r\n        {stores && body}\r\n      </table>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withTranslation('Common')(DicomStoreList);\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport api from './api/GoogleCloudApi';\r\nimport DicomStoreList from './DicomStoreList';\r\nimport './googleCloud.css';\r\n\r\nexport default class DicomStorePicker extends Component {\r\n  state = {\r\n    error: null,\r\n    loading: true,\r\n    stores: [],\r\n    locations: [],\r\n    filterStr: '',\r\n  };\r\n\r\n  static propTypes = {\r\n    dataset: PropTypes.object,\r\n    onSelect: PropTypes.func,\r\n    accessToken: PropTypes.string.isRequired,\r\n  };\r\n\r\n  async componentDidMount() {\r\n    api.setAccessToken(this.props.accessToken);\r\n\r\n    const response = await api.loadDicomStores(this.props.dataset.name);\r\n\r\n    if (response.isError) {\r\n      this.setState({\r\n        error: response.message,\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    this.setState({\r\n      stores: response.data.dicomStores || [],\r\n      loading: false,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { stores, loading, error, filterStr } = this.state;\r\n    const { onSelect } = this.props;\r\n\r\n    return (\r\n      <div>\r\n        <input\r\n          className=\"form-control gcp-input\"\r\n          type=\"text\"\r\n          value={filterStr}\r\n          onChange={e => this.setState({ filterStr: e.target.value })}\r\n        />\r\n        <DicomStoreList\r\n          stores={stores}\r\n          loading={loading}\r\n          error={error}\r\n          filter={filterStr}\r\n          onSelect={onSelect}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport './googleCloud.css';\r\nimport { withTranslation } from 'react-i18next';\r\nimport { Icon } from '@ohif/ui';\r\n\r\nclass DatasetsList extends Component {\r\n  state = {\r\n    search: '',\r\n  };\r\n\r\n  static propTypes = {\r\n    datasets: PropTypes.array,\r\n    loading: PropTypes.bool,\r\n    error: PropTypes.string,\r\n    onSelect: PropTypes.func,\r\n  };\r\n\r\n  static defaultProps = {\r\n    loading: true,\r\n  };\r\n\r\n  renderTableRow = dataset => {\r\n    return (\r\n      <tr\r\n        key={dataset.name}\r\n        className={\r\n          this.state.highlightedItem === dataset.name\r\n            ? 'noselect active'\r\n            : 'noselect'\r\n        }\r\n        onMouseEnter={() => {\r\n          this.onHighlightItem(dataset.name);\r\n        }}\r\n        onClick={() => {\r\n          this.props.onSelect(dataset);\r\n        }}\r\n      >\r\n        <td>{dataset.name.split('/')[5]}</td>\r\n      </tr>\r\n    );\r\n  };\r\n\r\n  onHighlightItem(dataset) {\r\n    this.setState({ highlightedItem: dataset });\r\n  }\r\n\r\n  render() {\r\n    const { loading, datasets, filter, error } = this.props;\r\n    \r\n    if (error) {\r\n      return <p>{error}</p>;\r\n    }\r\n\r\n    const loadingIcon = (\r\n      <Icon name=\"circle-notch\" className=\"loading-icon-spin loading-icon\" />\r\n    );\r\n\r\n    if (loading) {\r\n      return loadingIcon;\r\n    }\r\n\r\n    const body = (\r\n      <tbody id=\"DatasetList\">\r\n        {datasets.filter(dataset => (dataset.name.split('/')[5].toLowerCase().includes(filter.toLowerCase()) || filter==\"\")).map(this.renderTableRow)}\r\n      </tbody>\r\n    );\r\n\r\n    return (\r\n      <table id=\"tblDatasetList\" className=\"gcp-table table noselect\">\r\n        <thead>\r\n          <tr>\r\n            <th>{this.props.t('Dataset')}</th>\r\n          </tr>\r\n        </thead>\r\n        {datasets && body}\r\n      </table>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withTranslation('Common')(DatasetsList);\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport api from './api/GoogleCloudApi';\r\nimport DatasetsList from './DatasetsList';\r\nimport './googleCloud.css';\r\n\r\nexport default class DatasetPicker extends Component {\r\n  state = {\r\n    error: null,\r\n    loading: true,\r\n    datasets: [],\r\n    filterStr: '',\r\n  };\r\n\r\n  static propTypes = {\r\n    project: PropTypes.object,\r\n    location: PropTypes.object,\r\n    onSelect: PropTypes.func,\r\n    accessToken: PropTypes.string,\r\n  };\r\n\r\n  async componentDidMount() {\r\n    api.setAccessToken(this.props.accessToken);\r\n\r\n    const response = await api.loadDatasets(\r\n      this.props.project.projectId,\r\n      this.props.location.locationId\r\n    );\r\n\r\n    if (response.isError) {\r\n      this.setState({\r\n        error: response.message,\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    this.setState({\r\n      datasets: response.data.datasets || [],\r\n      loading: false,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { datasets, loading, error, filterStr } = this.state;\r\n    const { onSelect } = this.props;\r\n    return (\r\n      <div>\r\n        <input\r\n          className=\"form-control gcp-input\"\r\n          type=\"text\"\r\n          value={filterStr}\r\n          onChange={e => this.setState({ filterStr: e.target.value })}\r\n        />\r\n        <DatasetsList\r\n          datasets={datasets}\r\n          loading={loading}\r\n          error={error}\r\n          filter={filterStr}\r\n          onSelect={onSelect}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport './googleCloud.css';\r\nimport { withTranslation } from 'react-i18next';\r\nimport { Icon } from '@ohif/ui';\r\n\r\nclass ProjectsList extends Component {\r\n  state = {\r\n    search: '',\r\n    highlightedItem: null,\r\n  };\r\n\r\n  static propTypes = {\r\n    projects: PropTypes.array,\r\n    loading: PropTypes.bool.isRequired,\r\n    error: PropTypes.string,\r\n    onSelect: PropTypes.func.isRequired,\r\n    t: PropTypes.func,\r\n  };\r\n\r\n  static defaultProps = {\r\n    loading: true,\r\n  };\r\n\r\n  renderTableRow = project => {\r\n    return (\r\n      <tr\r\n        key={project.projectId}\r\n        className={\r\n          this.state.highlightedItem === project.projectId\r\n            ? 'noselect active'\r\n            : 'noselect'\r\n        }\r\n        onMouseEnter={() => {\r\n          this.onHighlightItem(project.projectId);\r\n        }}\r\n        onClick={() => {\r\n          this.onHighlightItem(project.projectId);\r\n          this.props.onSelect(project);\r\n        }}\r\n      >\r\n        <td>{project.name}</td>\r\n        <td>{project.projectId}</td>\r\n      </tr>\r\n    );\r\n  };\r\n\r\n  onHighlightItem(project) {\r\n    this.setState({ highlightedItem: project });\r\n  }\r\n\r\n  render() {\r\n    const { loading, projects, filter, error } = this.props;\r\n\r\n    if (error) {\r\n      return <p>{error}</p>;\r\n    }\r\n\r\n    const loadingIcon = (\r\n      <Icon name=\"circle-notch\" className=\"loading-icon-spin loading-icon\" />\r\n    );\r\n\r\n    if (loading) {\r\n      return loadingIcon;\r\n    }\r\n\r\n    const lowerCaseFilter = filter.toLowerCase();\r\n    const filteredProjects = projects.filter(project =>   \r\n      typeof project.name  === 'string' &&\r\n      (filter === \"\" || project.name.toLowerCase().includes(lowerCaseFilter))\r\n    );\r\n\r\n    const body = (\r\n      <tbody id=\"ProjectList\">\r\n        {\r\n          filteredProjects.map(this.renderTableRow)\r\n        }\r\n      </tbody>\r\n    );\r\n\r\n    return (\r\n      <table id=\"tblProjectList\" className=\"gcp-table table noselect\">\r\n        <thead>\r\n          <tr>\r\n            <th>{this.props.t('Project')}</th>\r\n            <th>{this.props.t('ID')}</th>\r\n          </tr>\r\n        </thead>\r\n        {projects && body}\r\n      </table>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withTranslation('Common')(ProjectsList);\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport api from './api/GoogleCloudApi';\r\nimport ProjectsList from './ProjectsList';\r\nimport './googleCloud.css';\r\n\r\nexport default class ProjectPicker extends Component {\r\n  state = {\r\n    error: null,\r\n    loading: true,\r\n    projects: [],\r\n  };\r\n\r\n  static propTypes = {\r\n    onSelect: PropTypes.func,\r\n    accessToken: PropTypes.string,\r\n  };\r\n\r\n  async componentDidMount() {\r\n    api.setAccessToken(this.props.accessToken);\r\n    const response = await api.loadProjects();\r\n\r\n    if (response.isError) {\r\n      this.setState({\r\n        error: response.message,\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    this.setState({\r\n      projects: response.data.projects || [],\r\n      filterStr: '',\r\n      loading: false,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { projects, loading, filterStr, error } = this.state;\r\n    const { onSelect } = this.props;\r\n    return (\r\n      <div>\r\n        <input\r\n          className=\"form-control gcp-input\"\r\n          type=\"text\"\r\n          value={filterStr}\r\n          onChange={e => this.setState({ filterStr: e.target.value })}\r\n        />\r\n        <ProjectsList\r\n          projects={projects}\r\n          loading={loading}\r\n          filter={filterStr}\r\n          error={error}\r\n          onSelect={onSelect}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport './googleCloud.css';\r\nimport { withTranslation } from 'react-i18next';\r\nimport { Icon } from '@ohif/ui';\r\n\r\nclass LocationsList extends Component {\r\n  state = {\r\n    search: '',\r\n  };\r\n\r\n  static propTypes = {\r\n    locations: PropTypes.array,\r\n    loading: PropTypes.bool.isRequired,\r\n    error: PropTypes.string,\r\n    onSelect: PropTypes.func,\r\n  };\r\n\r\n  static defaultProps = {\r\n    loading: true,\r\n  };\r\n\r\n  renderTableRow = location => {\r\n    return (\r\n      <tr\r\n        key={location.locationId}\r\n        className={\r\n          this.state.highlightedItem === location.locationId\r\n            ? 'noselect active'\r\n            : 'noselect'\r\n        }\r\n        onMouseEnter={() => {\r\n          this.onHighlightItem(location.locationId);\r\n        }}\r\n        onClick={() => {\r\n          this.props.onSelect(location);\r\n        }}\r\n      >\r\n        <td>{location.name.split('/')[3]}</td>\r\n      </tr>\r\n    );\r\n  };\r\n\r\n  onHighlightItem(locationId) {\r\n    this.setState({ highlightedItem: locationId });\r\n  }\r\n\r\n  render() {\r\n    const { loading, locations, filter, error } = this.props;\r\n\r\n    if (error) {\r\n      return <p>{error}</p>;\r\n    }\r\n\r\n    const loadingIcon = (\r\n      <Icon name=\"circle-notch\" className=\"loading-icon-spin loading-icon\" />\r\n    );\r\n\r\n    if (loading) {\r\n      return loadingIcon;\r\n    }\r\n\r\n    const body = (\r\n      <tbody id=\"LocationList\">\r\n        {locations.filter(location => (location.name.split('/')[3].toLowerCase().includes(filter.toLowerCase()) || filter==\"\")).map(this.renderTableRow)}\r\n      </tbody>\r\n    );\r\n\r\n    return (\r\n      <table id=\"tblLocationList\" className=\"gcp-table table noselect\">\r\n        <thead>\r\n          <tr>\r\n            <th>{this.props.t('Location')}</th>\r\n          </tr>\r\n        </thead>\r\n        {locations && body}\r\n      </table>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withTranslation('Common')(LocationsList);\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport api from './api/GoogleCloudApi';\r\nimport LocationsList from './LocationsList';\r\nimport './googleCloud.css';\r\n\r\nexport default class LocationPicker extends Component {\r\n  state = {\r\n    error: null,\r\n    loading: true,\r\n    locations: [],\r\n    filterStr: '',\r\n  };\r\n\r\n  static propTypes = {\r\n    project: PropTypes.object,\r\n    onSelect: PropTypes.func,\r\n    accessToken: PropTypes.string,\r\n  };\r\n\r\n  async componentDidMount() {\r\n    api.setAccessToken(this.props.accessToken);\r\n\r\n    const response = await api.loadLocations(this.props.project.projectId);\r\n\r\n    if (response.isError) {\r\n      this.setState({\r\n        error: response.message,\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    this.setState({\r\n      locations: response.data.locations || [],\r\n      loading: false,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { locations, loading, error, filterStr } = this.state;\r\n    const { onSelect } = this.props;\r\n    return (\r\n      <div>\r\n        <input\r\n          className=\"form-control gcp-input\"\r\n          type=\"text\"\r\n          value={filterStr}\r\n          onChange={e => this.setState({ filterStr: e.target.value })}\r\n        />\r\n        <LocationsList\r\n          locations={locations}\r\n          loading={loading}\r\n          error={error}\r\n          filter={filterStr}\r\n          onSelect={onSelect}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { withTranslation } from 'react-i18next';\r\nimport DicomStorePicker from './DicomStorePicker';\r\nimport DatasetPicker from './DatasetPicker';\r\nimport ProjectPicker from './ProjectPicker';\r\nimport LocationPicker from './LocationPicker';\r\nimport GoogleCloudApi from './api/GoogleCloudApi';\r\nimport './googleCloud.css';\r\n\r\nclass DatasetSelector extends Component {\r\n  state = {\r\n    project: null,\r\n    location: null,\r\n    dataset: null,\r\n    unloading: false,\r\n  };\r\n\r\n  static propTypes = {\r\n    id: PropTypes.string,\r\n    event: PropTypes.string,\r\n    user: PropTypes.object,\r\n    canClose: PropTypes.string,\r\n    setServers: PropTypes.func.isRequired,\r\n  };\r\n\r\n  onProjectSelect = project => {\r\n    this.setState({\r\n      project,\r\n    });\r\n  };\r\n\r\n  onLocationSelect = location => {\r\n    this.setState({\r\n      location,\r\n    });\r\n  };\r\n\r\n  onDatasetSelect = dataset => {\r\n    this.setState({\r\n      dataset,\r\n    });\r\n  };\r\n\r\n  onProjectClick = () => {\r\n    this.setState({\r\n      dataset: null,\r\n      location: null,\r\n      project: null,\r\n    });\r\n  };\r\n\r\n  onLocationClick = () => {\r\n    this.setState({\r\n      dataset: null,\r\n      location: null,\r\n    });\r\n  };\r\n\r\n  onDatasetClick = () => {\r\n    this.setState({\r\n      dataset: null,\r\n    });\r\n  };\r\n\r\n  onDicomStoreSelect = dicomStoreJson => {\r\n    const dicomStore = dicomStoreJson.name;\r\n    const parts = dicomStore.split('/');\r\n    const result = {\r\n      wadoUriRoot: GoogleCloudApi.urlBase + `/${dicomStore}/dicomWeb`,\r\n      qidoRoot: GoogleCloudApi.urlBase + `/${dicomStore}/dicomWeb`,\r\n      wadoRoot: GoogleCloudApi.urlBase + `/${dicomStore}/dicomWeb`,\r\n      project: parts[1],\r\n      location: parts[3],\r\n      dataset: parts[5],\r\n      dicomStore: parts[7],\r\n    };\r\n    this.props.setServers(result);\r\n  };\r\n\r\n  render() {\r\n    const accessToken = this.props.user.access_token;\r\n\r\n    const { project, location, dataset } = this.state;\r\n    const {\r\n      onProjectClick,\r\n      onLocationClick,\r\n      onDatasetClick,\r\n      onProjectSelect,\r\n      onLocationSelect,\r\n      onDatasetSelect,\r\n      onDicomStoreSelect,\r\n    } = this;\r\n\r\n    let projectBreadcrumbs = (\r\n      <div className=\"gcp-picker--path\">\r\n        <span>{this.props.t('Select a Project')}</span>\r\n      </div>\r\n    );\r\n\r\n    if (project) {\r\n      projectBreadcrumbs = (\r\n        <div className=\"gcp-picker--path\">\r\n          <span onClick={onProjectClick}>{project.name}</span>\r\n          {project && location && (\r\n            <span onClick={onLocationClick}>\r\n              {' '}\r\n              -> {location.name.split('/')[3]}\r\n            </span>\r\n          )}\r\n          {project && location && dataset && (\r\n            <span onClick={onDatasetClick}>\r\n              {' '}\r\n              -> {dataset.name.split('/')[5]}\r\n            </span>\r\n          )}\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <>\r\n        {projectBreadcrumbs}\r\n        {!project && (\r\n          <ProjectPicker accessToken={accessToken} onSelect={onProjectSelect} />\r\n        )}\r\n\r\n        {project && !location && (\r\n          <LocationPicker\r\n            accessToken={accessToken}\r\n            project={project}\r\n            onSelect={onLocationSelect}\r\n          />\r\n        )}\r\n        {project && location && !dataset && (\r\n          <DatasetPicker\r\n            accessToken={accessToken}\r\n            project={project}\r\n            location={location}\r\n            onSelect={onDatasetSelect}\r\n          />\r\n        )}\r\n        {project && location && dataset && (\r\n          <DicomStorePicker\r\n            accessToken={accessToken}\r\n            dataset={dataset}\r\n            onSelect={onDicomStoreSelect}\r\n          />\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withTranslation('Common')(DatasetSelector);\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport DatasetSelector from './DatasetSelector';\r\nimport './googleCloud.css';\r\nimport { withTranslation } from 'react-i18next';\r\nimport * as GoogleCloudUtilServers from './utils/getServers';\r\n\r\nimport { servicesManager } from './../App.js';\r\n\r\nfunction DicomStorePickerModal({\r\n  isOpen = false,\r\n  setServers,\r\n  onClose,\r\n  user,\r\n  url,\r\n  t,\r\n}) {\r\n  const { UIModalService } = servicesManager.services;\r\n\r\n  const showDicomStorePickerModal = () => {\r\n    const handleEvent = data => {\r\n      const servers = GoogleCloudUtilServers.getServers(data, data.dicomstore);\r\n      setServers(servers);\r\n\r\n      // Force auto close\r\n      UIModalService.hide();\r\n      onClose();\r\n    };\r\n\r\n    if (UIModalService) {\r\n      UIModalService.show({\r\n        content: DatasetSelector,\r\n        title: t('Google Cloud Healthcare API'),\r\n        contentProps: {\r\n          setServers: handleEvent,\r\n          user,\r\n          url,\r\n        },\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <React.Fragment>{isOpen && showDicomStorePickerModal()}</React.Fragment>\r\n  );\r\n}\r\n\r\nDicomStorePickerModal.propTypes = {\r\n  isOpen: PropTypes.bool.isRequired,\r\n  setServers: PropTypes.func.isRequired,\r\n  onClose: PropTypes.func,\r\n  user: PropTypes.object.isRequired,\r\n  url: PropTypes.string,\r\n};\r\n\r\nexport default withTranslation('Common')(DicomStorePickerModal);\r\n","import { connect } from 'react-redux';\r\nimport DicomStorePickerModal from './DicomStorePickerModal.js';\r\n\r\nconst isActive = a => a.active === true;\r\n\r\nconst mapStateToProps = state => {\r\n  const activeServer = state.servers.servers.find(isActive);\r\n\r\n  return {\r\n    user: state.oidc && state.oidc.user,\r\n    url: activeServer && activeServer.qidoRoot,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    setServers: servers => {\r\n      const action = {\r\n        type: 'SET_SERVERS',\r\n        servers,\r\n      };\r\n      dispatch(action);\r\n    },\r\n  };\r\n};\r\n\r\nconst ConnectedDicomStorePicker = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(DicomStorePickerModal);\r\n\r\nexport default ConnectedDicomStorePicker;\r\n","import React, { useState, useEffect, useContext } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport OHIF from '@ohif/core';\r\nimport { withRouter } from 'react-router-dom';\r\nimport { useTranslation } from 'react-i18next';\r\nimport {\r\n  StudyList,\r\n  PageToolbar,\r\n  TablePagination,\r\n  useDebounce,\r\n  useMedia,\r\n} from '@ohif/ui';\r\nimport ConnectedHeader from '../connectedComponents/ConnectedHeader.js';\r\nimport * as RoutesUtil from '../routes/routesUtil';\r\nimport moment from 'moment';\r\nimport ConnectedDicomFilesUploader from '../googleCloud/ConnectedDicomFilesUploader';\r\nimport ConnectedDicomStorePicker from '../googleCloud/ConnectedDicomStorePicker';\r\nimport filesToStudies from '../lib/filesToStudies.js';\r\n\r\n// Contexts\r\nimport UserManagerContext from '../context/UserManagerContext';\r\nimport WhiteLabellingContext from '../context/WhiteLabellingContext';\r\nimport AppContext from '../context/AppContext';\r\n\r\nconst { urlUtil: UrlUtil } = OHIF.utils;\r\n\r\nfunction StudyListRoute(props) {\r\n  const { history, server, user, studyListFunctionsEnabled } = props;\r\n  const [t] = useTranslation('Common');\r\n  // ~~ STATE\r\n  const [sort, setSort] = useState({\r\n    fieldName: 'PatientName',\r\n    direction: 'desc',\r\n  });\r\n  const [filterValues, setFilterValues] = useState({\r\n    studyDateTo: null,\r\n    studyDateFrom: null,\r\n    PatientName: '',\r\n    PatientID: '',\r\n    AccessionNumber: '',\r\n    StudyDate: '',\r\n    modalities: '',\r\n    StudyDescription: '',\r\n    //\r\n    patientNameOrId: '',\r\n    accessionOrModalityOrDescription: '',\r\n    //\r\n    allFields: '',\r\n  });\r\n  const [studies, setStudies] = useState([]);\r\n  const [searchStatus, setSearchStatus] = useState({\r\n    isSearchingForStudies: false,\r\n    error: null,\r\n  });\r\n  const [activeModalId, setActiveModalId] = useState(null);\r\n  const [rowsPerPage, setRowsPerPage] = useState(25);\r\n  const [pageNumber, setPageNumber] = useState(0);\r\n  const appContext = useContext(AppContext);\r\n  // ~~ RESPONSIVE\r\n  const displaySize = useMedia(\r\n    [\r\n      '(min-width: 1750px)',\r\n      '(min-width: 1000px) and (max-width: 1749px)',\r\n      '(max-width: 999px)',\r\n    ],\r\n    ['large', 'medium', 'small'],\r\n    'small'\r\n  );\r\n  // ~~ DEBOUNCED INPUT\r\n  const debouncedSort = useDebounce(sort, 200);\r\n  const debouncedFilters = useDebounce(filterValues, 250);\r\n\r\n  // Google Cloud Adapter for DICOM Store Picking\r\n  const { appConfig = {} } = appContext;\r\n  const isGoogleCHAIntegrationEnabled =\r\n    !server && appConfig.enableGoogleCloudAdapter;\r\n  if (isGoogleCHAIntegrationEnabled && activeModalId !== 'DicomStorePicker') {\r\n    setActiveModalId('DicomStorePicker');\r\n  }\r\n\r\n  // Called when relevant state/props are updated\r\n  // Watches filters and sort, debounced\r\n  useEffect(\r\n    () => {\r\n      const fetchStudies = async () => {\r\n        try {\r\n          setSearchStatus({ error: null, isSearchingForStudies: true });\r\n\r\n          const response = await getStudyList(\r\n            server,\r\n            debouncedFilters,\r\n            debouncedSort,\r\n            rowsPerPage,\r\n            pageNumber,\r\n            displaySize\r\n          );\r\n\r\n          setStudies(response);\r\n          setSearchStatus({ error: null, isSearchingForStudies: false });\r\n        } catch (error) {\r\n          console.warn(error);\r\n          setSearchStatus({ error: true, isFetching: false });\r\n        }\r\n      };\r\n\r\n      if (server) {\r\n        fetchStudies();\r\n      }\r\n    },\r\n    // TODO: Can we update studies directly?\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    [\r\n      debouncedFilters,\r\n      debouncedSort,\r\n      rowsPerPage,\r\n      pageNumber,\r\n      displaySize,\r\n      server,\r\n    ]\r\n  );\r\n\r\n  // TODO: Update Server\r\n  // if (this.props.server !== prevProps.server) {\r\n  //   this.setState({\r\n  //     modalComponentId: null,\r\n  //     searchData: null,\r\n  //     studies: null,\r\n  //   });\r\n  // }\r\n\r\n  const onDrop = async acceptedFiles => {\r\n    try {\r\n      const studiesFromFiles = await filesToStudies(acceptedFiles);\r\n      setStudies(studiesFromFiles);\r\n    } catch (error) {\r\n      setSearchStatus({ isSearchingForStudies: false, error });\r\n    }\r\n  };\r\n\r\n  if (searchStatus.error) {\r\n    return <div>Error: {JSON.stringify(searchStatus.error)}</div>;\r\n  } else if (studies === [] && !activeModalId) {\r\n    return <div>Loading...</div>;\r\n  }\r\n\r\n  let healthCareApiButtons = null;\r\n  let healthCareApiWindows = null;\r\n\r\n  if (appConfig.enableGoogleCloudAdapter) {\r\n    const isModalOpen = activeModalId === 'DicomStorePicker';\r\n    updateURL(isModalOpen, appConfig, server, history);\r\n\r\n    healthCareApiWindows = (\r\n      <ConnectedDicomStorePicker\r\n        isOpen={activeModalId === 'DicomStorePicker'}\r\n        onClose={() => setActiveModalId(null)}\r\n      />\r\n    );\r\n\r\n    healthCareApiButtons = (\r\n      <div\r\n        className=\"form-inline btn-group pull-right\"\r\n        style={{ padding: '20px' }}\r\n      >\r\n        <button\r\n          className=\"btn btn-primary\"\r\n          onClick={() => setActiveModalId('DicomStorePicker')}\r\n        >\r\n          {t('Change DICOM Store')}\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  function handleSort(fieldName) {\r\n    let sortFieldName = fieldName;\r\n    let sortDirection = 'asc';\r\n\r\n    if (fieldName === sort.fieldName) {\r\n      if (sort.direction === 'asc') {\r\n        sortDirection = 'desc';\r\n      } else {\r\n        sortFieldName = null;\r\n        sortDirection = null;\r\n      }\r\n    }\r\n\r\n    setSort({\r\n      fieldName: sortFieldName,\r\n      direction: sortDirection,\r\n    });\r\n  }\r\n\r\n  function handleFilterChange(fieldName, value) {\r\n    setFilterValues(state => {\r\n      return {\r\n        ...state,\r\n        [fieldName]: value,\r\n      };\r\n    });\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {studyListFunctionsEnabled ? (\r\n        <ConnectedDicomFilesUploader\r\n          isOpen={activeModalId === 'DicomFilesUploader'}\r\n          onClose={() => setActiveModalId(null)}\r\n        />\r\n      ) : null}\r\n      {healthCareApiWindows}\r\n      <WhiteLabellingContext.Consumer>\r\n        {whiteLabelling => (\r\n          <UserManagerContext.Consumer>\r\n            {userManager => (\r\n              <ConnectedHeader\r\n                home={true}\r\n                user={user}\r\n                userManager={userManager}\r\n              >\r\n                {whiteLabelling.logoComponent}\r\n              </ConnectedHeader>\r\n            )}\r\n          </UserManagerContext.Consumer>\r\n        )}\r\n      </WhiteLabellingContext.Consumer>\r\n      <div className=\"study-list-header\">\r\n        <div className=\"header\">\r\n          <h1 style={{ fontWeight: 300, fontSize: '22px' }}>\r\n            {t('StudyList')}\r\n          </h1>\r\n        </div>\r\n        <div className=\"actions\">\r\n          {studyListFunctionsEnabled && healthCareApiButtons}\r\n          {studyListFunctionsEnabled && (\r\n            <PageToolbar\r\n              onImport={() => setActiveModalId('DicomFilesUploader')}\r\n            />\r\n          )}\r\n          <span className=\"study-count\">{studies.length}</span>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"table-head-background\" />\r\n      <div className=\"study-list-container\">\r\n        {/* STUDY LIST OR DROP ZONE? */}\r\n        <StudyList\r\n          isLoading={searchStatus.isSearchingForStudies}\r\n          hasError={searchStatus.error === true}\r\n          // Rows\r\n          studies={studies}\r\n          onSelectItem={studyInstanceUID => {\r\n            const viewerPath = RoutesUtil.parseViewerPath(appConfig, server, {\r\n              studyInstanceUIDs: studyInstanceUID,\r\n            });\r\n            history.push(viewerPath);\r\n          }}\r\n          // Table Header\r\n          sort={sort}\r\n          onSort={handleSort}\r\n          filterValues={filterValues}\r\n          onFilterChange={handleFilterChange}\r\n          studyListDateFilterNumDays={appConfig.studyListDateFilterNumDays}\r\n          displaySize={displaySize}\r\n        />\r\n        {/* PAGINATION FOOTER */}\r\n        <TablePagination\r\n          currentPage={pageNumber}\r\n          nextPageFunc={() => setPageNumber(pageNumber + 1)}\r\n          prevPageFunc={() => setPageNumber(pageNumber - 1)}\r\n          onRowsPerPageChange={Rows => setRowsPerPage(Rows)}\r\n          rowsPerPage={rowsPerPage}\r\n          recordCount={studies.length}\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nStudyListRoute.propTypes = {\r\n  filters: PropTypes.object,\r\n  PatientID: PropTypes.string,\r\n  server: PropTypes.object,\r\n  user: PropTypes.object,\r\n  history: PropTypes.object,\r\n  studyListFunctionsEnabled: PropTypes.bool,\r\n};\r\n\r\nStudyListRoute.defaultProps = {\r\n  studyListFunctionsEnabled: true,\r\n};\r\n\r\nfunction updateURL(isModalOpen, appConfig, server, history) {\r\n  if (isModalOpen) {\r\n    return;\r\n  }\r\n\r\n  const listPath = RoutesUtil.parseStudyListPath(appConfig, server);\r\n\r\n  if (UrlUtil.paramString.isValidPath(listPath)) {\r\n    const { location = {} } = history;\r\n    if (location.pathname !== listPath) {\r\n      history.replace(listPath);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Not ideal, but we use displaySize to determine how the filters should be used\r\n * to build the collection of promises we need to fetch a result set.\r\n *\r\n * @param {*} server\r\n * @param {*} filters\r\n * @param {object} sort\r\n * @param {string} sort.fieldName - field to sort by\r\n * @param {string} sort.direction - direction to sort\r\n * @param {number} rowsPerPage - Number of results to return\r\n * @param {number} pageNumber - Used to determine results offset\r\n * @param {string} displaySize - small, medium, large\r\n * @returns\r\n */\r\nasync function getStudyList(\r\n  server,\r\n  filters,\r\n  sort,\r\n  rowsPerPage,\r\n  pageNumber,\r\n  displaySize\r\n) {\r\n  const {\r\n    allFields,\r\n    patientNameOrId,\r\n    accessionOrModalityOrDescription,\r\n  } = filters;\r\n  const sortFieldName = sort.fieldName || 'PatientName';\r\n  const sortDirection = sort.direction || 'desc';\r\n  const studyDateFrom =\r\n    filters.studyDateFrom ||\r\n    moment()\r\n      .subtract(25000, 'days')\r\n      .toDate();\r\n  const studyDateTo = filters.studyDateTo || new Date();\r\n\r\n  const mappedFilters = {\r\n    PatientID: filters.PatientID,\r\n    PatientName: filters.PatientName,\r\n    AccessionNumber: filters.AccessionNumber,\r\n    StudyDescription: filters.StudyDescription,\r\n    ModalitiesInStudy: filters.modalities,\r\n    // NEVER CHANGE\r\n    studyDateFrom,\r\n    studyDateTo,\r\n    limit: rowsPerPage,\r\n    offset: pageNumber * rowsPerPage,\r\n    fuzzymatching: server.supportsFuzzyMatching === true,\r\n  };\r\n\r\n  const studies = await _fetchStudies(server, mappedFilters, displaySize, {\r\n    allFields,\r\n    patientNameOrId,\r\n    accessionOrModalityOrDescription,\r\n  });\r\n\r\n  // Only the fields we use\r\n  const mappedStudies = studies.map(study => {\r\n    const PatientName =\r\n      typeof study.PatientName === 'string' ? study.PatientName : undefined;\r\n\r\n    return {\r\n      AccessionNumber: study.AccessionNumber, // \"1\"\r\n      modalities: study.modalities, // \"SEG\\\\MR\"  \r\n      // numberOfStudyRelatedInstances: \"3\"\r\n      // numberOfStudyRelatedSeries: \"3\"\r\n      // PatientBirthdate: undefined\r\n      PatientID: study.PatientID, // \"NOID\"\r\n      PatientName, // \"NAME^NONE\"\r\n      // PatientSex: \"M\"\r\n      // referringPhysicianName: undefined\r\n      StudyDate: study.StudyDate, // \"Jun 28, 2002\"\r\n      StudyDescription: study.StudyDescription, // \"BRAIN\"\r\n      // studyId: \"No Study ID\"\r\n      StudyInstanceUID: study.StudyInstanceUID, // \"1.3.6.1.4.1.5962.99.1.3814087073.479799962.1489872804257.3.0\"\r\n      // StudyTime: \"160956.0\"\r\n    };\r\n  });\r\n\r\n  // For our smaller displays, map our field name to a single\r\n  // field we can actually sort by.\r\n  const sortFieldNameMapping = {\r\n    allFields: 'PatientName',\r\n    patientNameOrId: 'PatientName',\r\n    accessionOrModalityOrDescription: 'modalities',\r\n  };\r\n  const mappedSortFieldName =\r\n    sortFieldNameMapping[sortFieldName] || sortFieldName;\r\n\r\n  const sortedStudies = _sortStudies(\r\n    mappedStudies,\r\n    mappedSortFieldName,\r\n    sortDirection\r\n  );\r\n\r\n  // Because we've merged multiple requests, we may have more than\r\n  // our Rows per page. Let's `take` that number from our sorted array.\r\n  // This \"might\" cause paging issues.\r\n  const numToTake =\r\n    sortedStudies.length < rowsPerPage ? sortedStudies.length : rowsPerPage;\r\n  const result = sortedStudies.slice(0, numToTake);\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n *\r\n *\r\n * @param {object[]} studies - Array of studies to sort\r\n * @param {string} studies.StudyDate - Date in 'MMM DD, YYYY' format\r\n * @param {string} field - name of properties on study to sort by\r\n * @param {string} order - 'asc' or 'desc'\r\n * @returns\r\n */\r\nfunction _sortStudies(studies, field, order) {\r\n  // Make sure our StudyDate is in a valid format and create copy of studies array\r\n  const sortedStudies = studies.map(study => {\r\n    if (!moment(study.StudyDate, 'MMM DD, YYYY', true).isValid()) {\r\n      study.StudyDate = moment(study.StudyDate, 'YYYYMMDD').format(\r\n        'MMM DD, YYYY'\r\n      );\r\n    }\r\n    return study;\r\n  });\r\n\r\n  // Sort by field\r\n  sortedStudies.sort(function(a, b) {\r\n    let fieldA = a[field];\r\n    let fieldB = b[field];\r\n    if (field === 'StudyDate') {\r\n      fieldA = moment(fieldA).toISOString();\r\n      fieldB = moment(fieldB).toISOString();\r\n    }\r\n\r\n    // Order\r\n    if (order === 'desc') {\r\n      if (fieldA < fieldB) {\r\n        return -1;\r\n      }\r\n      if (fieldA > fieldB) {\r\n        return 1;\r\n      }\r\n      return 0;\r\n    } else {\r\n      if (fieldA > fieldB) {\r\n        return -1;\r\n      }\r\n      if (fieldA < fieldB) {\r\n        return 1;\r\n      }\r\n      return 0;\r\n    }\r\n  });\r\n\r\n  return sortedStudies;\r\n}\r\n\r\n/**\r\n * We're forced to do this because DICOMWeb does not support \"AND|OR\" searches\r\n * across multiple fields. This allows us to make multiple requests, remove\r\n * duplicates, and return the result set as if it were supported\r\n *\r\n * @param {object} server\r\n * @param {Object} filters\r\n * @param {string} displaySize - small, medium, or large\r\n * @param {string} multi.allFields\r\n * @param {string} multi.patientNameOrId\r\n * @param {string} multi.accessionOrModalityOrDescription\r\n */\r\nasync function _fetchStudies(\r\n  server,\r\n  filters,\r\n  displaySize,\r\n  { allFields, patientNameOrId, accessionOrModalityOrDescription }\r\n) {\r\n  let queryFiltersArray = [filters];\r\n\r\n  if (displaySize === 'small') {\r\n    const firstSet = _getQueryFiltersForValue(\r\n      filters,\r\n      [\r\n        'PatientID',\r\n        'PatientName',\r\n        'AccessionNumber',\r\n        'StudyDescription',\r\n        'ModalitiesInStudy',\r\n      ],\r\n      allFields\r\n    );\r\n\r\n    if (firstSet.length) {\r\n      queryFiltersArray = firstSet;\r\n    }\r\n  } else if (displaySize === 'medium') {\r\n    const firstSet = _getQueryFiltersForValue(\r\n      filters,\r\n      ['PatientID', 'PatientName'],\r\n      patientNameOrId\r\n    );\r\n\r\n    const secondSet = _getQueryFiltersForValue(\r\n      filters,\r\n      ['AccessionNumber', 'StudyDescription', 'ModalitiesInStudy'],\r\n      accessionOrModalityOrDescription\r\n    );\r\n\r\n    if (firstSet.length || secondSet.length) {\r\n      queryFiltersArray = firstSet.concat(secondSet);\r\n    }\r\n  }\r\n\r\n  const queryPromises = [];\r\n\r\n  queryFiltersArray.forEach(filter => {\r\n    const searchStudiesPromise = OHIF.studies.searchStudies(server, filter);\r\n    queryPromises.push(searchStudiesPromise);\r\n  });\r\n\r\n  const lotsOfStudies = await Promise.all(queryPromises);\r\n  const studies = [];\r\n\r\n  // Flatten and dedupe\r\n  lotsOfStudies.forEach(arrayOfStudies => {\r\n    if (arrayOfStudies) {\r\n      arrayOfStudies.forEach(study => {\r\n        if (!studies.some(s => s.StudyInstanceUID === study.StudyInstanceUID)) {\r\n          studies.push(study);\r\n        }\r\n      });\r\n    }\r\n  });\r\n\r\n  return studies;\r\n}\r\n\r\n/**\r\n *\r\n *\r\n * @param {*} filters\r\n * @param {*} fields - Array of string fields\r\n * @param {*} value\r\n */\r\nfunction _getQueryFiltersForValue(filters, fields, value) {\r\n  const queryFilters = [];\r\n\r\n  if (value === '' || !value) {\r\n    return queryFilters;\r\n  }\r\n\r\n  fields.forEach(field => {\r\n    const filter = Object.assign(\r\n      {\r\n        PatientID: '',\r\n        PatientName: '',\r\n        AccessionNumber: '',\r\n        StudyDescription: '',\r\n        ModalitiesInStudy: '',\r\n      },\r\n      filters\r\n    );\r\n\r\n    filter[field] = value;\r\n    queryFilters.push(filter);\r\n  });\r\n\r\n  return queryFilters;\r\n}\r\n\r\nexport default withRouter(StudyListRoute);\r\n","import { connect } from 'react-redux';\r\n\r\nimport StudyListRoute from './StudyListRoute.js';\r\n\r\nconst isActive = a => a.active === true;\r\n\r\nconst mapStateToProps = state => {\r\n  const activeServer = state.servers.servers.find(isActive);\r\n\r\n  return {\r\n    server: activeServer,\r\n    user: state.oidc.user,\r\n  };\r\n};\r\n\r\nconst ConnectedStudyList = connect(\r\n  mapStateToProps,\r\n  null\r\n)(StudyListRoute);\r\n\r\nexport default ConnectedStudyList;\r\n","import React, { useContext } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { withRouter } from 'react-router-dom';\r\nimport ConnectedStudyList from './ConnectedStudyList';\r\nimport useServer from '../customHooks/useServer';\r\nimport OHIF from '@ohif/core';\r\nconst { urlUtil: UrlUtil } = OHIF.utils;\r\n\r\n// Contexts\r\nimport AppContext from '../context/AppContext';\r\n\r\nfunction StudyListRouting({ match: routeMatch, location: routeLocation }) {\r\n  const {\r\n    project,\r\n    location,\r\n    dataset,\r\n    dicomStore,\r\n    studyInstanceUIDs,\r\n    seriesInstanceUIDs,\r\n  } = routeMatch.params;\r\n  const server = useServer({ project, location, dataset, dicomStore });\r\n  const { appConfig = {} } = useContext(AppContext);\r\n\r\n  const filters = UrlUtil.queryString.getQueryFilters(routeLocation);\r\n\r\n  let studyListFunctionsEnabled = false;\r\n  if (appConfig.studyListFunctionsEnabled) {\r\n    studyListFunctionsEnabled = appConfig.studyListFunctionsEnabled;\r\n  }\r\n  return (\r\n    <ConnectedStudyList\r\n      filters={filters}\r\n      studyListFunctionsEnabled={studyListFunctionsEnabled}\r\n    />\r\n  );\r\n}\r\n\r\nStudyListRouting.propTypes = {\r\n  location: PropTypes.shape({\r\n    search: PropTypes.string,\r\n  }).isRequired,\r\n};\r\n\r\nexport default withRouter(StudyListRouting);\r\n","import React, { useEffect, useRef } from 'react';\r\nexport default function usePrevious(value) {\r\n  const ref = useRef();\r\n  useEffect(() => {\r\n    ref.current = value;\r\n  }, [value]);\r\n\r\n  return ref.current;\r\n}\r\n","class GoogleCloudApi {\r\n  setAccessToken(accessToken) {\r\n    if (!accessToken) console.error('Access token is empty');\r\n    this.accessToken = accessToken;\r\n  }\r\n\r\n  get fetchConfig() {\r\n    if (!this.accessToken) throw new Error('OIDC access_token is not set');\r\n    return {\r\n      method: 'GET',\r\n      headers: {\r\n        Authorization: 'Bearer ' + this.accessToken,\r\n      },\r\n    };\r\n  }\r\n\r\n  get urlBase() {\r\n    return this.healthcareApiEndpoint || 'https://healthcare.googleapis.com/v1beta1';\r\n  }\r\n\r\n  set urlBase(url) {\r\n    this.healthcareApiEndpoint = url;\r\n  }\r\n\r\n  get urlBaseProject() {\r\n    return this.urlBase + `/projects`;\r\n  }\r\n\r\n  getUrlBaseDicomWeb(project, location, dataset, dicomStore) {\r\n    return (\r\n      this.urlBase +\r\n      `/projects/${project}/locations/${location}/datasets/${dataset}/dicomStores/${dicomStore}/dicomWeb`\r\n    );\r\n  }\r\n\r\n  getUrlPath(project, location, dataset, dicomStore) {\r\n    `/projects/${project}/locations/${location}/datasets/${dataset}/dicomStores/${dicomStore}`;\r\n  }\r\n\r\n  async doRequest(urlStr, config = {}, params = {}) {\r\n    const url = new URL(urlStr);\r\n    let data = null;\r\n    url.search = new URLSearchParams(params);\r\n\r\n    try {\r\n      const response = await fetch(url, { ...this.fetchConfig, config });\r\n      try {\r\n        data = await response.json();\r\n      } catch (err) {}\r\n      if (response.status >= 200 && response.status < 300 && data != null) {\r\n        if (data.nextPageToken != null) {\r\n          params.pageToken = data.nextPageToken;\r\n          let subPage = await this.doRequest(urlStr, config, params);\r\n          for (let key in data) {\r\n            if (data.hasOwnProperty(key)) {\r\n              data[key] = data[key].concat(subPage.data[key]);\r\n            }\r\n          }\r\n        }\r\n        return {\r\n          isError: false,\r\n          status: response.status,\r\n          data,\r\n        };\r\n      } else {\r\n        return {\r\n          isError: true,\r\n          status: response.status,\r\n          message:\r\n            (data && data.error && data.error.message) || 'Unknown error',\r\n        };\r\n      }\r\n    } catch (err) {\r\n      if (data && data.error) {\r\n        return {\r\n          isError: true,\r\n          status: err.status,\r\n          message: err.response.data.error.message || 'Unspecified error',\r\n        };\r\n      }\r\n      return {\r\n        isError: true,\r\n        message: (err && err.message) || 'Oops! Something went wrong',\r\n      };\r\n    }\r\n  }\r\n\r\n  async loadProjects() {\r\n    return this.doRequest(\r\n      'https://cloudresourcemanager.googleapis.com/v1/projects'\r\n    );\r\n  }\r\n\r\n  async loadLocations(projectId) {\r\n    return this.doRequest(`${this.urlBaseProject}/${projectId}/locations`);\r\n  }\r\n\r\n  async loadDatasets(projectId, locationId) {\r\n    return this.doRequest(\r\n      `${this.urlBaseProject}/${projectId}/locations/${locationId}/datasets`\r\n    );\r\n  }\r\n\r\n  async loadDicomStores(dataset) {\r\n    return this.doRequest(`${this.urlBase}/${dataset}/dicomStores`);\r\n  }\r\n}\r\n\r\nexport default new GoogleCloudApi();\r\n","const getServers = (data, name) => {\r\n  const {\r\n    wadoUriRoot,\r\n    qidoRoot,\r\n    wadoRoot,\r\n    dataset = '',\r\n    dicomStore = '',\r\n    location = '',\r\n    project = '',\r\n  } = data;\r\n\r\n  return [\r\n    {\r\n      name: name,\r\n      dataset,\r\n      dicomStore,\r\n      location,\r\n      project,\r\n      imageRendering: 'wadors',\r\n      thumbnailRendering: 'wadors',\r\n      type: 'dicomWeb',\r\n      active: true,\r\n      wadoUriRoot,\r\n      qidoRoot,\r\n      wadoRoot,\r\n      supportsFuzzyMatching: false,\r\n      qidoSupportsIncludeField: false,\r\n    },\r\n  ];\r\n};\r\n\r\nconst isValidServer = server => {\r\n  return (\r\n    server &&\r\n    !!server.dataset &&\r\n    !!server.dicomStore &&\r\n    !!server.location &&\r\n    !!server.project\r\n  );\r\n};\r\n\r\nconst isEqualServer = (server = {}, toCompare = {}) => {\r\n  const serverLength = Object.keys(server).length;\r\n  const toCompareLength = Object.keys(toCompare).length;\r\n\r\n  if (!serverLength || !toCompareLength) {\r\n    return false;\r\n  }\r\n\r\n  return (\r\n    server.dataset === toCompare.dataset &&\r\n    server.dataset === toCompare.dataset &&\r\n    server.dicomStore === toCompare.dicomStore &&\r\n    server.location === toCompare.location &&\r\n    server.project === toCompare.project\r\n  );\r\n};\r\n\r\nexport { getServers, isValidServer, isEqualServer };\r\n","import React, { useContext } from 'react';\r\nimport GoogleCloudApi from '../googleCloud/api/GoogleCloudApi';\r\nimport usePrevious from './usePrevious';\r\n\r\nimport * as GoogleCloudUtilServers from '../googleCloud/utils/getServers';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport isEqual from 'lodash.isequal';\r\n\r\n// Contexts\r\nimport AppContext from '../context/AppContext';\r\n\r\nconst getActiveServer = servers => {\r\n  const isActive = a => a.active === true;\r\n\r\n  return servers && servers.servers && servers.servers.find(isActive);\r\n};\r\n\r\nconst getServers = (appConfig, project, location, dataset, dicomStore) => {\r\n  let servers = [];\r\n  if (appConfig.enableGoogleCloudAdapter) {\r\n    GoogleCloudApi.urlBase = appConfig.healthcareApiEndpoint;\r\n    const pathUrl = GoogleCloudApi.getUrlBaseDicomWeb(\r\n      project,\r\n      location,\r\n      dataset,\r\n      dicomStore\r\n    );\r\n    const data = {\r\n      project,\r\n      location,\r\n      dataset,\r\n      dicomStore,\r\n      wadoUriRoot: pathUrl,\r\n      qidoRoot: pathUrl,\r\n      wadoRoot: pathUrl,\r\n    };\r\n    servers = GoogleCloudUtilServers.getServers(data, dicomStore);\r\n    if (!isValidServer(servers[0], appConfig)) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  return servers;\r\n};\r\n\r\nconst isValidServer = (server, appConfig) => {\r\n  if (appConfig.enableGoogleCloudAdapter) {\r\n    return GoogleCloudUtilServers.isValidServer(server);\r\n  }\r\n\r\n  return !!server;\r\n};\r\n\r\nconst setServers = (dispatch, servers) => {\r\n  const action = {\r\n    type: 'SET_SERVERS',\r\n    servers,\r\n  };\r\n  dispatch(action);\r\n};\r\n\r\nconst useServerFromUrl = (\r\n  servers = [],\r\n  previousServers,\r\n  activeServer,\r\n  urlBasedServers,\r\n  appConfig,\r\n  project,\r\n  location,\r\n  dataset,\r\n  dicomStore\r\n) => {\r\n  // update state from url available only when gcloud on\r\n  if (!appConfig.enableGoogleCloudAdapter) {\r\n    return false;\r\n  }\r\n\r\n  const serverHasChanged = previousServers !== servers && previousServers;\r\n\r\n  // do not update from url. use state instead.\r\n  if (serverHasChanged) {\r\n    return false;\r\n  }\r\n\r\n  // if no valid urlbased servers\r\n  if (!urlBasedServers || !urlBasedServers.length) {\r\n    return false;\r\n  } else if (!servers.length || !activeServer) {\r\n    // no current valid server\r\n    return true;\r\n  }\r\n\r\n  const newServer = urlBasedServers[0];\r\n\r\n  let exists = servers.some(\r\n    GoogleCloudUtilServers.isEqualServer.bind(undefined, newServer)\r\n  );\r\n\r\n  return !exists;\r\n};\r\n\r\nexport default function useServer({\r\n  project,\r\n  location,\r\n  dataset,\r\n  dicomStore,\r\n} = {}) {\r\n  // Hooks\r\n  const servers = useSelector(state => state && state.servers);\r\n  const previousServers = usePrevious(servers);\r\n  const dispatch = useDispatch();\r\n\r\n  const { appConfig = {} } = useContext(AppContext);\r\n\r\n  const activeServer = getActiveServer(servers);\r\n  const urlBasedServers =\r\n    getServers(appConfig, project, location, dataset, dicomStore) || [];\r\n  const shouldUpdateServer = useServerFromUrl(\r\n    servers.servers,\r\n    previousServers,\r\n    activeServer,\r\n    urlBasedServers,\r\n    appConfig,\r\n    project,\r\n    location,\r\n    dataset,\r\n    dicomStore\r\n  );\r\n\r\n  if (shouldUpdateServer) {\r\n    setServers(dispatch, urlBasedServers);\r\n  } else if (isValidServer(activeServer, appConfig)) {\r\n    return activeServer;\r\n  }\r\n}\r\n","export default class FileLoader {\r\n  fileType;\r\n  loadFile(file, imageId) { }\r\n  getDataset(image, imageId) { }\r\n  getStudies(dataset, imageId) { }\r\n}\r\n","import FileLoader from './fileLoader';\r\nimport { getCornerstoneWADOImageLoader } from '../../utils/cornerstoneWADOImageLoader';\r\n\r\nconst PDFFileLoader = new (class extends FileLoader {\r\n  fileType = 'application/pdf';\r\n  async loadFile(file, imageId) {\r\n    const cornerstoneWADOImageLoader = await getCornerstoneWADOImageLoader();\r\n    return cornerstoneWADOImageLoader.wadouri.loadFileRequest(imageId);\r\n  }\r\n\r\n  getDataset(image, imageId) {\r\n    const dataset = {};\r\n    dataset.imageId = image.imageId || imageId;\r\n    return dataset;\r\n  }\r\n\r\n  getStudies(dataset, imageId) {\r\n    return this.getDefaultStudy(imageId);\r\n  }\r\n\r\n  getDefaultStudy(imageId) {\r\n    const study = {\r\n      StudyInstanceUID: '',\r\n      StudyDate: '',\r\n      StudyTime: '',\r\n      AccessionNumber: '',\r\n      ReferringPhysicianName: '',\r\n      PatientName: '',\r\n      PatientID: '',\r\n      PatientBirthdate: '',\r\n      PatientSex: '',\r\n      StudyId: '',\r\n      StudyDescription: '',\r\n      series: [\r\n        {\r\n          SeriesInstanceUID: '',\r\n          SeriesDescription: '',\r\n          SeriesNumber: '',\r\n          instances: [\r\n            {\r\n              metadata: {\r\n                SOPInstanceUID: '',\r\n                SOPClassUID: '1.2.840.10008.5.1.4.1.1.104.1',\r\n                Rows: '',\r\n                Columns: '',\r\n                NumberOfFrames: 0,\r\n                InstanceNumber: 1,\r\n              },\r\n              getImageId: () => imageId,\r\n              isLocalFile: true,\r\n            },\r\n          ],\r\n        },\r\n      ],\r\n    };\r\n\r\n    return study;\r\n  }\r\n})();\r\n\r\nexport default PDFFileLoader;\r\n","import * as dcmjs from 'dcmjs';\r\nimport FileLoader from './fileLoader';\r\nimport OHIF from '@ohif/core';\r\nimport { getCornerstoneWADOImageLoader } from '../../utils/cornerstoneWADOImageLoader';\r\n\r\nconst metadataProvider = OHIF.cornerstone.metadataProvider;\r\n\r\nconst DICOMFileLoader = new (class extends FileLoader {\r\n  fileType = 'application/dicom';\r\n  async loadFile(file, imageId) {\r\n    const cornerstoneWADOImageLoader = await getCornerstoneWADOImageLoader();\r\n    return cornerstoneWADOImageLoader.wadouri.loadFileRequest(imageId);\r\n  }\r\n\r\n  getDataset(image, imageId) {\r\n    let dataset = {};\r\n    try {\r\n      const dicomData = dcmjs.data.DicomMessage.readFile(image);\r\n\r\n      dataset = dcmjs.data.DicomMetaDictionary.naturalizeDataset(\r\n        dicomData.dict\r\n      );\r\n\r\n      metadataProvider.addInstance(dataset);\r\n\r\n      dataset._meta = dcmjs.data.DicomMetaDictionary.namifyDataset(\r\n        dicomData.meta\r\n      );\r\n    } catch (e) {\r\n      console.error('Error reading dicom file', e);\r\n    }\r\n    // Set imageId on dataset to be consumed later on\r\n    dataset.imageId = imageId;\r\n\r\n    return dataset;\r\n  }\r\n\r\n  getStudies(dataset, imageId) {\r\n    return this.getStudyFromDataset(dataset);\r\n  }\r\n\r\n  getStudyFromDataset(dataset = {}) {\r\n    const {\r\n      StudyInstanceUID,\r\n      StudyDate,\r\n      StudyTime,\r\n      AccessionNumber,\r\n      ReferringPhysicianName,\r\n      PatientName,\r\n      PatientID,\r\n      PatientBirthDate,\r\n      PatientSex,\r\n      StudyID,\r\n      StudyDescription,\r\n      SeriesInstanceUID,\r\n      SeriesDescription,\r\n      SeriesNumber,\r\n      imageId,\r\n    } = dataset;\r\n\r\n    const instance = {\r\n      metadata: dataset,\r\n      url: imageId,\r\n    };\r\n\r\n    const series = {\r\n      SeriesInstanceUID: SeriesInstanceUID,\r\n      SeriesDescription: SeriesDescription,\r\n      SeriesNumber: SeriesNumber,\r\n      instances: [instance],\r\n    };\r\n\r\n    const study = {\r\n      StudyInstanceUID,\r\n      StudyDate,\r\n      StudyTime,\r\n      AccessionNumber,\r\n      ReferringPhysicianName,\r\n      PatientName,\r\n      PatientID,\r\n      PatientBirthDate,\r\n      PatientSex,\r\n      StudyID,\r\n      StudyDescription,\r\n      /*\r\n      TODO: in case necessary to uncomment this block, double check every property\r\n      numberOfStudyRelatedSeries: NumberOfStudyRelatedSeries || DICOMWeb.getString(dataset['00201206']),\r\n      numberOfStudyRelatedInstances: NumberOfStudyRelatedInstances || DICOMWeb.getString(dataset['00201208']),\r\n      Modality: Modality || DICOMWeb.getString(dataset['00080060']),\r\n      ModalitiesInStudy: ModalitiesInStudy || DICOMWeb.getString(dataset['00080061']),\r\n      modalities:\r\n      */\r\n      series: [series],\r\n    };\r\n\r\n    return study;\r\n  }\r\n})();\r\n\r\nexport default DICOMFileLoader;\r\n","import FileLoader from './fileLoader';\r\nimport PDFFileLoader from './pdfFileLoader';\r\nimport DICOMFileLoader from './dicomFileLoader';\r\nimport { getCornerstoneWADOImageLoader } from '../../utils/cornerstoneWADOImageLoader';\r\n\r\nclass FileLoaderService extends FileLoader {\r\n  fileType;\r\n  loader;\r\n  constructor(file) {\r\n    super();\r\n    const fileType = file && file.type;\r\n    this.loader = this.getLoader(fileType);\r\n    this.fileType = this.loader.fileType;\r\n  }\r\n\r\n  static groupSeries(studies) {\r\n    const groupBy = (list, groupByKey, listKey) => {\r\n      let nonKeyCounter = 1;\r\n\r\n      return list.reduce((acc, obj) => {\r\n        let key = obj[groupByKey];\r\n        const list = obj[listKey];\r\n\r\n        // in case key not found, group it using counter\r\n        key = !!key ? key : '' + nonKeyCounter++;\r\n\r\n        if (!acc[key]) {\r\n          acc[key] = { ...obj };\r\n          acc[key][listKey] = [];\r\n        }\r\n\r\n        acc[key][listKey].push(...list);\r\n\r\n        return acc;\r\n      }, {});\r\n    };\r\n\r\n    const studiesGrouped = Object.values(\r\n      groupBy(studies, 'StudyInstanceUID', 'series')\r\n    );\r\n\r\n    const result = studiesGrouped.map(studyGroup => {\r\n      const seriesGrouped = groupBy(\r\n        studyGroup.series,\r\n        'SeriesInstanceUID',\r\n        'instances'\r\n      );\r\n      studyGroup.series = Object.values(seriesGrouped);\r\n\r\n      return studyGroup;\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  async addFile(file) {\r\n    const cornerstoneWADOImageLoader = await getCornerstoneWADOImageLoader();\r\n    return cornerstoneWADOImageLoader.wadouri.fileManager.add(file);\r\n  }\r\n\r\n  loadFile(file, imageId) {\r\n    return this.loader.loadFile(file, imageId);\r\n  }\r\n\r\n  getDataset(image, imageId) {\r\n    return this.loader.getDataset(image, imageId);\r\n  }\r\n\r\n  getStudies(dataset, imageId) {\r\n    return this.loader.getStudies(dataset, imageId);\r\n  }\r\n\r\n  getLoader(fileType) {\r\n    if (fileType === 'application/pdf') {\r\n      return PDFFileLoader;\r\n    } else {\r\n      // Default to dicom loader\r\n      return DICOMFileLoader;\r\n    }\r\n  }\r\n}\r\n\r\nexport default FileLoaderService;\r\n","import FileLoaderService from './localFileLoaders/fileLoaderService';\r\n\r\nconst processFile = async file => {\r\n  try {\r\n    const fileLoaderService = new FileLoaderService(file);\r\n    const imageId = await fileLoaderService.addFile(file);\r\n    const image = await fileLoaderService.loadFile(file, imageId);\r\n    const dataset = await fileLoaderService.getDataset(image, imageId);\r\n    const studies = await fileLoaderService.getStudies(dataset, imageId);\r\n\r\n    return studies;\r\n  } catch (error) {\r\n    console.log(\r\n      error.name,\r\n      ':Error when trying to load and process local files:',\r\n      error.message\r\n    );\r\n  }\r\n};\r\n\r\nexport default async function filesToStudies(files) {\r\n  const processFilesPromises = files.map(processFile);\r\n  const studies = await Promise.all(processFilesPromises);\r\n\r\n  return FileLoaderService.groupSeries(studies.flat());\r\n}\r\n"],"sourceRoot":""}